{"ast":null,"code":"import React,{createContext,useContext,useReducer,useEffect}from'react';// æˆ˜åœºé…ç½®\nimport{jsx as _jsx}from\"react/jsx-runtime\";const battlefields=[{id:'novice',name:'æ–°æ‰‹æ‘',levelRange:[1,10],background:'#e6f7ff',description:'é€‚åˆ1-10çº§ç©å®¶çš„æ–°æ‰‹æˆ˜åœº'},{id:'intermediate',name:'è¿›é˜¶æ£®æ—',levelRange:[11,20],background:'#e6ffe6',description:'é€‚åˆ11-20çº§ç©å®¶çš„è¿›é˜¶æˆ˜åœº'},{id:'hell',name:'åœ°ç‹±çº§éš¾åº¦',levelRange:[21,30],background:'#ffe6e6',description:'é€‚åˆ21-30çº§ç©å®¶çš„é«˜éš¾åº¦æˆ˜åœº'}];// è£…å¤‡ç±»å‹å®šä¹‰\nconst equipmentTypes={HEAD:{id:'HEAD',name:'å¤´éƒ¨',emoji:'ğŸ§¢',slot:'head'},BODY:{id:'BODY',name:'èº«ä½“',emoji:'ğŸ‘•',slot:'body'},BELT:{id:'BELT',name:'è…°å¸¦',emoji:'ğŸ§¶',slot:'belt'},SHOES:{id:'SHOES',name:'é‹å­',emoji:'ğŸ‘',slot:'shoes'},WEAPON:{id:'WEAPON',name:'æ­¦å™¨',emoji:'ğŸ—¡ï¸',slot:'weapon'},NECKLACE:{id:'NECKLACE',name:'é¡¹é“¾',emoji:'ğŸ“¿',slot:'necklace'},ACCESSORY:{id:'ACCESSORY',name:'é¦–é¥°',emoji:'ğŸ’',slot:'accessory'}};// è£…å¤‡ç¨€æœ‰åº¦å®šä¹‰\nconst rarities={COMMON:{id:'COMMON',name:'æ™®é€š',color:'#a0a0a0',chance:0.6,multiplier:1},UNCOMMON:{id:'UNCOMMON',name:'ä¼˜ç§€',color:'#1eff00',chance:0.3,multiplier:1.5},RARE:{id:'RARE',name:'ç²¾è‰¯',color:'#0070dd',chance:0.08,multiplier:2},EPIC:{id:'EPIC',name:'å²è¯—',color:'#a335ee',chance:0.02,multiplier:2.5},LEGENDARY:{id:'LEGENDARY',name:'ä¼ è¯´',color:'#ff8000',chance:0.004,multiplier:3}};// è£…å¤‡å±æ€§å®šä¹‰\nconst attributeTypes={HEALTH:{id:'HEALTH',name:'ç”Ÿå‘½å€¼',min:5,max:20,scaling:2},ATTACK:{id:'ATTACK',name:'æ”»å‡»åŠ›',min:1,max:5,scaling:0.5},DEFENSE:{id:'DEFENSE',name:'é˜²å¾¡åŠ›',min:1,max:3,scaling:0.3},AGILITY:{id:'AGILITY',name:'æ•æ·åº¦',min:1,max:3,scaling:0.3},CRIT_CHANCE:{id:'CRIT_CHANCE',name:'æš´å‡»ç‡',min:0.01,max:0.03,scaling:0.003}};// æŒ‰è£…å¤‡ç±»å‹åˆ’åˆ†å¯èƒ½çš„å±æ€§ (æŸäº›å±æ€§åªåœ¨ç‰¹å®šè£…å¤‡ä¸Šå‡ºç°)\nconst equipmentAttributes={HEAD:['HEALTH','DEFENSE'],BODY:['HEALTH','DEFENSE'],BELT:['HEALTH','AGILITY'],SHOES:['AGILITY','DEFENSE'],WEAPON:['ATTACK','CRIT_CHANCE'],NECKLACE:['HEALTH','CRIT_CHANCE'],ACCESSORY:['ATTACK','AGILITY','CRIT_CHANCE']};// éšæœºç”Ÿæˆè£…å¤‡\nconst generateEquipment=function(playerLevel){let dropRateBonus=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;// è£…å¤‡ç­‰çº§èŒƒå›´\nconst equipLevel=Math.max(1,Math.floor(playerLevel*(0.8+Math.random()*0.4)));// éšæœºè£…å¤‡ç±»å‹\nconst equipTypeKeys=Object.keys(equipmentTypes);const randomType=equipmentTypes[equipTypeKeys[Math.floor(Math.random()*equipTypeKeys.length)]];// éšæœºç¨€æœ‰åº¦ (ä½¿ç”¨æ¦‚ç‡æƒé‡)\nlet rarityRoll=Math.random()-dropRateBonus;// æ‰è½ç‡åŠ æˆæé«˜ç¨€æœ‰åº¦æ¦‚ç‡\nrarityRoll=Math.max(0,rarityRoll);// ç¡®ä¿ä¸ä¼šæ˜¯è´Ÿæ•°\nlet selectedRarity;if(rarityRoll<rarities.LEGENDARY.chance){selectedRarity=rarities.LEGENDARY;}else if(rarityRoll<rarities.EPIC.chance+rarities.LEGENDARY.chance){selectedRarity=rarities.EPIC;}else if(rarityRoll<rarities.RARE.chance+rarities.EPIC.chance+rarities.LEGENDARY.chance){selectedRarity=rarities.RARE;}else if(rarityRoll<rarities.UNCOMMON.chance+rarities.RARE.chance+rarities.EPIC.chance+rarities.LEGENDARY.chance){selectedRarity=rarities.UNCOMMON;}else{selectedRarity=rarities.COMMON;}// ç¡®å®šå±æ€§æ•°é‡ (åŸºäºç¨€æœ‰åº¦)\nconst attrCount=Math.floor(Math.random()*2)+1;// 1-2ä¸ªå±æ€§\n// éšæœºé€‰æ‹©å±æ€§\nconst possibleAttributes=equipmentAttributes[randomType.id];const shuffledAttributes=[...possibleAttributes].sort(()=>0.5-Math.random());const selectedAttributes=shuffledAttributes.slice(0,attrCount);// ä¸ºæ¯ä¸ªå±æ€§éšæœºç”Ÿæˆæ•°å€¼\nconst attributes={};selectedAttributes.forEach(attrKey=>{const attr=attributeTypes[attrKey];// åŸºç¡€å±æ€§å€¼ + ç­‰çº§ç¼©æ”¾ * ç¨€æœ‰åº¦å€ç‡\nconst baseValue=attr.min+Math.random()*(attr.max-attr.min);const levelScaling=attr.scaling*equipLevel;let value=(baseValue+levelScaling)*selectedRarity.multiplier;// å¯¹æš´å‡»ç‡è¿›è¡Œç‰¹æ®Šå¤„ç†ï¼Œç¡®ä¿ä¸è¶…è¿‡åˆç†èŒƒå›´\nif(attrKey==='CRIT_CHANCE'){value=Math.min(value,0.25);// æœ€é«˜25%æš´å‡»ç‡\nvalue=Math.round(value*1000)/1000;// ä¿ç•™3ä½å°æ•°\n}else{value=Math.floor(value);// å…¶ä»–å±æ€§å–æ•´\n}attributes[attrKey]=value;});// ç”Ÿæˆè£…å¤‡åç§°\nconst prefixes=['é”‹åˆ©çš„','åšå›ºçš„','é—ªäº®çš„','ç ´æ—§çš„','ç¥ç§˜çš„','å¤è€çš„','å¼ºåŒ–çš„','ç²¾åˆ¶çš„','é­”æ³•çš„','ä¼ æ‰¿çš„'];const randomPrefix=prefixes[Math.floor(Math.random()*prefixes.length)];const name=`${randomPrefix} ${randomType.name}`;// ç”Ÿæˆå”¯ä¸€ID\nconst id=`equip_${Date.now()}_${Math.floor(Math.random()*1000)}`;return{id,name,type:randomType.id,emoji:randomType.emoji,slot:randomType.slot,level:equipLevel,rarity:selectedRarity.id,rarityName:selectedRarity.name,rarityColor:selectedRarity.color,attributes};};// æ€ªç‰©é…ç½®ï¼ˆæ ¹æ®ç­‰çº§ç”Ÿæˆï¼‰\nconst generateMonster=(playerLevel,battlefieldId)=>{// æ ¹æ®æˆ˜åœºç¡®å®šæ€ªç‰©ç­‰çº§èŒƒå›´\nlet minLevel=playerLevel-2;let maxLevel=playerLevel+2;const battlefield=battlefields.find(bf=>bf.id===battlefieldId);// ç¡®ä¿æ€ªç‰©ç­‰çº§åœ¨æˆ˜åœºèŒƒå›´å†…\nif(battlefield){minLevel=Math.max(minLevel,battlefield.levelRange[0]);maxLevel=Math.min(maxLevel,battlefield.levelRange[1]);}// éšæœºç¡®å®šæ€ªç‰©ç­‰çº§\nconst monsterLevel=Math.floor(Math.random()*(maxLevel-minLevel+1))+minLevel;// æ€ªç‰©ç±»å‹\nconst monsterTypes=[{name:'å²è±å§†',emoji:'ğŸŸ¢',baseHealth:50,baseAttack:5,baseDefense:2,baseAgility:1},{name:'è™è ',emoji:'ğŸ¦‡',baseHealth:40,baseAttack:7,baseDefense:1,baseAgility:5},{name:'éª·é«…',emoji:'ğŸ’€',baseHealth:60,baseAttack:6,baseDefense:3,baseAgility:2},{name:'èœ˜è››',emoji:'ğŸ•·ï¸',baseHealth:45,baseAttack:6,baseDefense:2,baseAgility:4},{name:'å¹½çµ',emoji:'ğŸ‘»',baseHealth:55,baseAttack:8,baseDefense:0,baseAgility:6},{name:'å·¨é­”',emoji:'ğŸ‘¹',baseHealth:70,baseAttack:9,baseDefense:4,baseAgility:1},{name:'æ¶é­”',emoji:'ğŸ˜ˆ',baseHealth:65,baseAttack:10,baseDefense:3,baseAgility:3}];// æ ¹æ®æˆ˜åœºéš¾åº¦é€‰æ‹©æ€ªç‰©\nlet availableMonsters;if(battlefieldId==='novice'){availableMonsters=monsterTypes.slice(0,3);// ç®€å•æ€ªç‰©\n}else if(battlefieldId==='intermediate'){availableMonsters=monsterTypes.slice(2,5);// ä¸­ç­‰æ€ªç‰©\n}else{availableMonsters=monsterTypes.slice(4);// å›°éš¾æ€ªç‰©\n}// éšæœºé€‰æ‹©ä¸€ç§æ€ªç‰©\nconst monsterType=availableMonsters[Math.floor(Math.random()*availableMonsters.length)];// åŸºäºç­‰çº§è®¡ç®—æ€ªç‰©å±æ€§\nconst levelMultiplier=1+(monsterLevel-1)*0.1;// æ¯çº§æå‡10%\nreturn{name:`${monsterLevel}çº§${monsterType.name}`,emoji:monsterType.emoji,level:monsterLevel,maxHealth:Math.floor(monsterType.baseHealth*levelMultiplier),currentHealth:Math.floor(monsterType.baseHealth*levelMultiplier),attack:Math.floor(monsterType.baseAttack*levelMultiplier),defense:Math.floor(monsterType.baseDefense*levelMultiplier),agility:Math.floor(monsterType.baseAgility*levelMultiplier),critChance:0.1+monsterLevel*0.005,// åŸºç¡€10%ï¼Œæ¯çº§+0.5%\ncritMultiplier:1.5,// æ€ªç‰©ç»éªŒå€¼ï¼šåŸºç¡€å€¼ + ç­‰çº§åŠ æˆ\nexpReward:10+monsterLevel*5,// æ‰è½è£…å¤‡æ¦‚ç‡ (20% + ç­‰çº§åŠ æˆ)\ndropChance:0.2+monsterLevel*0.01};};// è®¡ç®—å‡çº§æ‰€éœ€ç»éªŒ\nconst calculateExpToNextLevel=level=>{// ä½¿ç”¨æŒ‡æ•°å¢é•¿å…¬å¼: 100 * (level)^1.5\nreturn Math.floor(100*Math.pow(level,1.5));};// è®¡ç®—è£…å¤‡æä¾›çš„å±æ€§æ€»å’Œ\nconst calculateEquipmentStats=equipment=>{const stats={health:0,attack:0,defense:0,agility:0,critChance:0};// éå†æ‰€æœ‰è£…å¤‡æ§½ä½\nObject.values(equipment).forEach(equip=>{if(!equip)return;// å¦‚æœæ§½ä½æ²¡æœ‰è£…å¤‡\n// ç´¯åŠ è£…å¤‡å±æ€§\nObject.entries(equip.attributes).forEach(_ref=>{let[key,value]=_ref;switch(key){case'HEALTH':stats.health+=value;break;case'ATTACK':stats.attack+=value;break;case'DEFENSE':stats.defense+=value;break;case'AGILITY':stats.agility+=value;break;case'CRIT_CHANCE':stats.critChance+=value;break;default:break;}});});return stats;};// åˆå§‹çŠ¶æ€\n// åˆå§‹çŠ¶æ€\nconst createInitialState=()=>{try{// å°è¯•ä»localStorageè¯»å–ä¿å­˜çš„çŠ¶æ€\nconst savedState=localStorage.getItem('rpgGameState');if(savedState){const parsedState=JSON.parse(savedState);// æ£€æŸ¥å¹¶ç¡®ä¿æ‰€æœ‰å…³é”®å±æ€§éƒ½å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™ä½¿ç”¨é»˜è®¤å€¼\n// ç¡®ä¿inventoryå­˜åœ¨\nif(!parsedState.inventory){parsedState.inventory={maxSlots:20,items:[]};}// ç¡®ä¿modalå­˜åœ¨\nif(!parsedState.modal){parsedState.modal={isOpen:false,type:null,data:null};}// ç¡®ä¿equipmentå­˜åœ¨\nif(!parsedState.equipment){parsedState.equipment={head:null,body:null,belt:null,shoes:null,weapon:null,necklace:null,accessory:null};}return parsedState;}}catch(e){console.error('Failed to parse saved game state:',e);}// é»˜è®¤åˆå§‹çŠ¶æ€\nreturn{// æ¸¸æˆåœºæ™¯çŠ¶æ€: 'select' - æˆ˜åœºé€‰æ‹©é¡µé¢, 'battle' - æˆ˜æ–—é¡µé¢\ngameScene:'select',selectedBattlefield:null,// è§’è‰²åŸºç¡€å±æ€§\nplayer:{name:\"å‹‡è€…\",level:1,experience:0,expToNextLevel:calculateExpToNextLevel(1),maxHealth:100,currentHealth:100,attack:10,defense:5,agility:3,// æ–°å¢æ•æ·åº¦å±æ€§\ncritChance:0.1,critMultiplier:1.5},// è£…å¤‡ç³»ç»Ÿ\nequipment:{head:null,body:null,belt:null,shoes:null,weapon:null,necklace:null,accessory:null},// ç‰©å“æ \ninventory:{maxSlots:20,// ç‰©å“æ æœ€å¤§æ ¼å­æ•°\nitems:[]// ç‰©å“åˆ—è¡¨ï¼Œæ¯ä¸ªç‰©å“åŒ…å« {id, count, ...itemData}\n},// æ¨¡æ€çª—å£çŠ¶æ€\nmodal:{isOpen:false,type:null,// 'character', 'equipment', 'inventory'\ndata:null},// ç‰©å“å³é”®èœå•çŠ¶æ€\ncontextMenu:{isOpen:false,position:{x:0,y:0},item:null},monster:null,battleLogs:[],playerAttacking:false,monsterAttacking:false,playerDamaged:false,monsterDamaged:false,gameSpeed:2000,// æ¯å›åˆé—´éš”(æ¯«ç§’)\ngameRunning:true,battlefields:battlefields};};// Reducerå‡½æ•°æ¥å¤„ç†çŠ¶æ€æ›´æ–°\nfunction gameReducer(state,action){let newState;switch(action.type){// é€‰æ‹©æˆ˜åœº\ncase'SELECT_BATTLEFIELD':newState={...state,gameScene:'battle',selectedBattlefield:action.payload,battleLogs:[{id:Date.now(),text:`è¿›å…¥${action.payload.name}æˆ˜åœºï¼`,isCritical:false}],// ç”Ÿæˆæ–°æ€ªç‰©\nmonster:generateMonster(state.player.level,action.payload.id)};break;// è¿”å›é€‰æ‹©é¡µé¢\ncase'RETURN_TO_SELECT':newState={...state,gameScene:'select',monster:null,battleLogs:[]};break;// æ‰“å¼€æ¨¡æ€çª—å£\ncase'OPEN_MODAL':newState={...state,modal:{isOpen:true,type:action.payload.type,data:action.payload.data||null}};break;// å…³é—­æ¨¡æ€çª—å£\ncase'CLOSE_MODAL':newState={...state,modal:{...state.modal,isOpen:false}};break;// æ‰“å¼€å³é”®èœå•\ncase'OPEN_CONTEXT_MENU':newState={...state,contextMenu:{isOpen:true,position:action.payload.position,item:action.payload.item}};break;// å…³é—­å³é”®èœå•\ncase'CLOSE_CONTEXT_MENU':newState={...state,contextMenu:{...state.contextMenu,isOpen:false}};break;// è£…å¤‡ç‰©å“\ncase'EQUIP_ITEM':{const item=action.payload;const{slot}=item;// æ£€æŸ¥æ˜¯å¦å·²ç»æœ‰è£…å¤‡åœ¨è¯¥æ§½ä½\nconst existingEquipment=state.equipment[slot];let newInventory={...state.inventory};// ä»ç‰©å“æ ç§»é™¤è¦è£…å¤‡çš„ç‰©å“\nnewInventory.items=newInventory.items.filter(invItem=>{if(invItem.id===item.id){if(invItem.count>1){invItem.count--;return true;}return false;}return true;});// å¦‚æœæ§½ä½å·²æœ‰è£…å¤‡ï¼Œå°†å…¶æ”¾å›ç‰©å“æ \nif(existingEquipment){// æ£€æŸ¥ç‰©å“æ æ˜¯å¦å·²æœ‰ç›¸åŒç‰©å“\nconst existingInvItem=newInventory.items.find(i=>i.id===existingEquipment.id||i.name===existingEquipment.name&&i.level===existingEquipment.level);if(existingInvItem){existingInvItem.count++;}else{// æ£€æŸ¥ç‰©å“æ æ˜¯å¦å·²æ»¡\nif(newInventory.items.length<newInventory.maxSlots){newInventory.items.push({...existingEquipment,count:1});}else{// å¦‚æœæ»¡äº†ï¼Œæ·»åŠ æç¤º\nnewState={...state,battleLogs:[{id:Date.now(),text:`ç‰©å“æ å·²æ»¡ï¼Œæ— æ³•å¸ä¸‹${existingEquipment.name}ï¼`,isCritical:true},...state.battleLogs.slice(0,19)]};break;}}}// åˆ›å»ºæ–°çš„è£…å¤‡çŠ¶æ€\nconst newEquipment={...state.equipment,[slot]:{...item,count:1}};// è·å–æ–°çš„è£…å¤‡åŠ æˆ\nconst equipStats=calculateEquipmentStats(newEquipment);// æ›´æ–°ç©å®¶å±æ€§ï¼ˆåŸºç¡€å±æ€§+è£…å¤‡åŠ æˆï¼‰\nconst basePlayer={...state.player};const updatedPlayer={...basePlayer,maxHealth:basePlayer.maxHealth+equipStats.health,currentHealth:Math.min(basePlayer.currentHealth+equipStats.health,basePlayer.maxHealth+equipStats.health),attack:basePlayer.attack+equipStats.attack,defense:basePlayer.defense+equipStats.defense,agility:basePlayer.agility+equipStats.agility,critChance:basePlayer.critChance+equipStats.critChance};newState={...state,equipment:newEquipment,inventory:newInventory,player:updatedPlayer,battleLogs:[{id:Date.now(),text:`è£…å¤‡äº†${item.name}ï¼`,isCritical:false},...state.battleLogs.slice(0,19)]};}break;// å¸ä¸‹è£…å¤‡\ncase'UNEQUIP_ITEM':{const slot=action.payload;const item=state.equipment[slot];if(!item){newState=state;break;}// æ£€æŸ¥ç‰©å“æ æ˜¯å¦å·²æ»¡\nif(state.inventory.items.length>=state.inventory.maxSlots){newState={...state,battleLogs:[{id:Date.now(),text:`ç‰©å“æ å·²æ»¡ï¼Œæ— æ³•å¸ä¸‹${item.name}ï¼`,isCritical:true},...state.battleLogs.slice(0,19)]};break;}// æ£€æŸ¥ç‰©å“æ æ˜¯å¦å·²æœ‰ç›¸åŒç‰©å“\nlet newInventory={...state.inventory};const existingItem=newInventory.items.find(i=>i.id===item.id||i.name===item.name&&i.level===item.level);if(existingItem){existingItem.count++;}else{newInventory.items.push({...item,count:1});}// åˆ›å»ºæ–°çš„è£…å¤‡çŠ¶æ€\nconst newEquipment={...state.equipment,[slot]:null};// è·å–æ–°çš„è£…å¤‡åŠ æˆ\nconst equipStats=calculateEquipmentStats(newEquipment);// æ›´æ–°ç©å®¶å±æ€§ï¼ˆåŸºç¡€å±æ€§+è£…å¤‡åŠ æˆï¼‰\nconst basePlayer={...state.player};const updatedPlayer={...basePlayer,maxHealth:basePlayer.maxHealth-equipStats.health,currentHealth:Math.min(basePlayer.currentHealth,basePlayer.maxHealth-equipStats.health),attack:basePlayer.attack-equipStats.attack,defense:basePlayer.defense-equipStats.defense,agility:basePlayer.agility-equipStats.agility,critChance:basePlayer.critChance-equipStats.critChance};newState={...state,equipment:newEquipment,inventory:newInventory,player:updatedPlayer,battleLogs:[{id:Date.now(),text:`å¸ä¸‹äº†${item.name}ï¼`,isCritical:false},...state.battleLogs.slice(0,19)]};}break;// ä¸¢å¼ƒç‰©å“\ncase'DISCARD_ITEM':{const item=action.payload;// ä»ç‰©å“æ ç§»é™¤ç‰©å“\nconst newInventory={...state.inventory};newInventory.items=newInventory.items.filter(invItem=>invItem.id!==item.id);newState={...state,inventory:newInventory,battleLogs:[{id:Date.now(),text:`ä¸¢å¼ƒäº†${item.name} x${item.count}ï¼`,isCritical:false},...state.battleLogs.slice(0,19)]};}break;// è·å¾—ç‰©å“\ncase'GAIN_ITEM':{const item=action.payload;// æ£€æŸ¥ç‰©å“æ æ˜¯å¦å·²æ»¡\nif(state.inventory.items.length>=state.inventory.maxSlots){// ç‰©å“æ å·²æ»¡ï¼Œæ— æ³•è·å¾—ç‰©å“\nnewState={...state,battleLogs:[{id:Date.now(),text:`ç‰©å“æ å·²æ»¡ï¼Œæ— æ³•è·å¾—${item.name}ï¼`,isCritical:true},...state.battleLogs.slice(0,19)]};break;}// æ£€æŸ¥ç‰©å“æ æ˜¯å¦å·²æœ‰ç›¸åŒç‰©å“\nconst newInventory={...state.inventory};const existingItem=newInventory.items.find(i=>i.id===item.id||i.name===item.name&&i.level===item.level&&i.rarity===item.rarity);if(existingItem){// å¦‚æœå·²æœ‰ç›¸åŒç‰©å“ï¼Œå¢åŠ æ•°é‡\nexistingItem.count++;}else{// å¦åˆ™æ·»åŠ æ–°ç‰©å“\nnewInventory.items.push({...item,count:1});}newState={...state,inventory:newInventory,battleLogs:[{id:Date.now(),text:`è·å¾—äº†${item.name}ï¼`,isCritical:false},...state.battleLogs.slice(0,19)]};}break;// ç©å®¶æ”»å‡»\ncase'PLAYER_ATTACK':newState={...state,playerAttacking:true};break;// ç©å®¶æ”»å‡»ç»“æŸ\ncase'PLAYER_ATTACK_END':newState={...state,playerAttacking:false};break;// æ€ªç‰©å—ä¼¤\ncase'MONSTER_DAMAGE':newState={...state,monsterDamaged:true,monster:{...state.monster,currentHealth:Math.max(0,state.monster.currentHealth-action.payload.damage)},battleLogs:[{id:Date.now(),text:action.payload.isCritical?`æš´å‡»ï¼${state.player.name}å¯¹${state.monster.name}é€ æˆäº†${action.payload.damage}ç‚¹ä¼¤å®³ï¼`:`${state.player.name}å¯¹${state.monster.name}é€ æˆäº†${action.payload.damage}ç‚¹ä¼¤å®³ã€‚`,isCritical:action.payload.isCritical},...state.battleLogs.slice(0,19)]};break;// æ€ªç‰©å—ä¼¤ç»“æŸ\ncase'MONSTER_DAMAGE_END':newState={...state,monsterDamaged:false};break;// æ€ªç‰©æ”»å‡»\ncase'MONSTER_ATTACK':newState={...state,monsterAttacking:true};break;// æ€ªç‰©æ”»å‡»ç»“æŸ\ncase'MONSTER_ATTACK_END':newState={...state,monsterAttacking:false};break;// ç©å®¶å—ä¼¤\ncase'PLAYER_DAMAGE':newState={...state,playerDamaged:true,player:{...state.player,currentHealth:Math.max(0,state.player.currentHealth-action.payload.damage)},battleLogs:[{id:Date.now(),text:action.payload.isCritical?`æš´å‡»ï¼${state.monster.name}å¯¹${state.player.name}é€ æˆäº†${action.payload.damage}ç‚¹ä¼¤å®³ï¼`:`${state.monster.name}å¯¹${state.player.name}é€ æˆäº†${action.payload.damage}ç‚¹ä¼¤å®³ã€‚`,isCritical:action.payload.isCritical},...state.battleLogs.slice(0,19)]};break;// ç©å®¶å—ä¼¤ç»“æŸ\ncase'PLAYER_DAMAGE_END':newState={...state,playerDamaged:false};break;// æ·»åŠ æ—¥å¿—\ncase'ADD_LOG':newState={...state,battleLogs:[{id:Date.now(),text:action.payload.text,isCritical:action.payload.isCritical},...state.battleLogs.slice(0,19)]};break;// ç©å®¶è·å¾—ç»éªŒ\ncase'PLAYER_GAIN_EXPERIENCE':{const expGained=action.payload.experience;let updatedPlayer={...state.player};updatedPlayer.experience+=expGained;// æ£€æŸ¥æ˜¯å¦å‡çº§\nlet leveledUp=false;while(updatedPlayer.experience>=updatedPlayer.expToNextLevel){// å‡çº§\nupdatedPlayer.level+=1;updatedPlayer.experience-=updatedPlayer.expToNextLevel;updatedPlayer.expToNextLevel=calculateExpToNextLevel(updatedPlayer.level);// å±æ€§æå‡\nconst healthIncrease=Math.floor(20+updatedPlayer.level*5);updatedPlayer.maxHealth+=healthIncrease;updatedPlayer.currentHealth+=healthIncrease;updatedPlayer.attack+=2;updatedPlayer.defense+=1;updatedPlayer.agility+=1;// æ¯10çº§å¢åŠ æš´å‡»ç‡\nif(updatedPlayer.level%10===0){updatedPlayer.critChance+=0.05;}leveledUp=true;}const newLogs=leveledUp?[{id:Date.now(),text:`è·å¾—${expGained}ç‚¹ç»éªŒï¼å‡çº§åˆ°${updatedPlayer.level}çº§ï¼`,isCritical:true},...state.battleLogs]:[{id:Date.now(),text:`è·å¾—${expGained}ç‚¹ç»éªŒï¼`,isCritical:false},...state.battleLogs];newState={...state,player:updatedPlayer,battleLogs:newLogs.slice(0,20)};}break;// æ‰è½è£…å¤‡\ncase'DROP_EQUIPMENT':{// æ£€æŸ¥æ˜¯å¦æ‰è½è£…å¤‡\nconst monster=state.monster;const randomRoll=Math.random();if(randomRoll<=monster.dropChance){// ç”Ÿæˆè£…å¤‡\nconst equipment=generateEquipment(monster.level);// æ£€æŸ¥ç‰©å“æ æ˜¯å¦å·²æ»¡\nif(state.inventory.items.length>=state.inventory.maxSlots){// ç‰©å“æ å·²æ»¡ï¼Œæ— æ³•è·å¾—è£…å¤‡\nnewState={...state,battleLogs:[{id:Date.now(),text:`æ€ªç‰©æ‰è½äº†${equipment.rarityName}å“è´¨çš„${equipment.name}ï¼Œä½†ç‰©å“æ å·²æ»¡ï¼Œæ— æ³•æ‹¾å–ï¼`,isCritical:true},...state.battleLogs.slice(0,19)]};break;}// æ·»åŠ è£…å¤‡åˆ°ç‰©å“æ \nconst newInventory={...state.inventory};newInventory.items.push({...equipment,count:1});newState={...state,inventory:newInventory,battleLogs:[{id:Date.now(),text:`æ€ªç‰©æ‰è½äº†${equipment.rarityName}å“è´¨çš„${equipment.name}ï¼`,isCritical:true},...state.battleLogs.slice(0,19)]};}else{// æ²¡æœ‰æ‰è½è£…å¤‡\nnewState=state;}}break;// é‡ç½®æ€ªç‰©\ncase'RESET_MONSTER':newState={...state,monster:generateMonster(state.player.level,state.selectedBattlefield.id),battleLogs:[{id:Date.now(),text:\"æ–°çš„æ€ªç‰©å‡ºç°äº†ï¼\",isCritical:false},...state.battleLogs.slice(0,19)]};break;// æ¢å¤ç©å®¶ç”Ÿå‘½å€¼\ncase'RESET_PLAYER_HEALTH':newState={...state,player:{...state.player,currentHealth:state.player.maxHealth},battleLogs:[{id:Date.now(),text:`${state.player.name}æ¢å¤äº†å¥åº·ï¼`,isCritical:false},...state.battleLogs.slice(0,19)]};break;// åˆ‡æ¢æ¸¸æˆè¿è¡ŒçŠ¶æ€\ncase'TOGGLE_GAME':newState={...state,gameRunning:!state.gameRunning};break;default:return state;}// ä¿å­˜çŠ¶æ€åˆ°localStorage\nlocalStorage.setItem('rpgGameState',JSON.stringify(newState));return newState;}// åˆ›å»ºContext\nconst GameContext=/*#__PURE__*/createContext();// è‡ªå®šä¹‰é’©å­ï¼Œæ–¹ä¾¿ç»„ä»¶ä½¿ç”¨Context\nexport function useGame(){return useContext(GameContext);}// Providerç»„ä»¶\nexport function GameProvider(_ref2){let{children}=_ref2;const[state,dispatch]=useReducer(gameReducer,null,createInitialState);// æˆ˜æ–—ä¼¤å®³è®¡ç®—\nconst calculateDamage=(attacker,defender)=>{// åŸºç¡€ä¼¤å®³ = æ”»å‡»åŠ› - é˜²å¾¡åŠ›/2\nlet baseDamage=Math.max(1,attacker.attack-defender.defense/2);// æ•æ·å½±å“å‘½ä¸­å’Œé—ªé¿\nconst agilityDiff=attacker.agility-defender.agility;// å‘½ä¸­ç‡è°ƒæ•´ (åŠ æˆæˆ–å‡å°‘æœ€å¤š20%)\nconst hitRateAdjustment=Math.min(0.2,Math.max(-0.2,agilityDiff*0.02));const baseHitRate=0.9;// åŸºç¡€90%å‘½ä¸­ç‡\nconst hitRate=Math.min(0.99,Math.max(0.7,baseHitRate+hitRateAdjustment));// æ£€æŸ¥æ˜¯å¦å‘½ä¸­\nif(Math.random()>hitRate){// é—ªé¿\nreturn 0;}// éšæœºæ³¢åŠ¨ (Â±20%)\nconst randomFactor=0.8+Math.random()*0.4;return Math.floor(baseDamage*randomFactor);};// æ¸¸æˆä¸»å¾ªç¯\nuseEffect(()=>{// åªåœ¨æˆ˜æ–—åœºæ™¯ä¸”æ¸¸æˆæ­£åœ¨è¿è¡Œæ—¶æ‰§è¡Œæˆ˜æ–—å¾ªç¯\nif(state.gameScene!=='battle'||!state.gameRunning||!state.monster)return;const gameLoop=setInterval(()=>{// æ£€æŸ¥ç©å®¶æ˜¯å¦æ­»äº¡\nif(state.player.currentHealth<=0){dispatch({type:'ADD_LOG',payload:{text:`æˆ˜æ–—å¤±è´¥ï¼${state.player.name}è¢«${state.monster.name}å‡»è´¥äº†ï¼`,isCritical:true}});// å»¶è¿Ÿåè¿”å›é€‰æ‹©é¡µé¢\nsetTimeout(()=>{dispatch({type:'RETURN_TO_SELECT'});},2000);return;}// æ£€æŸ¥æ€ªç‰©æ˜¯å¦æ­»äº¡\nif(state.monster.currentHealth<=0){dispatch({type:'ADD_LOG',payload:{text:`æˆ˜æ–—èƒœåˆ©ï¼${state.player.name}å‡»è´¥äº†${state.monster.name}ï¼`,isCritical:true}});// è·å¾—ç»éªŒå€¼\ndispatch({type:'PLAYER_GAIN_EXPERIENCE',payload:{experience:state.monster.expReward}});// æ£€æŸ¥æ˜¯å¦æ‰è½è£…å¤‡\ndispatch({type:'DROP_EQUIPMENT'});// æ¢å¤ç©å®¶è¡€é‡\nsetTimeout(()=>{dispatch({type:'RESET_PLAYER_HEALTH'});},1000);// ç”Ÿæˆæ–°æ€ªç‰©\nsetTimeout(()=>{dispatch({type:'RESET_MONSTER'});},2000);return;}// ç©å®¶æ”»å‡»\ndispatch({type:'PLAYER_ATTACK'});setTimeout(()=>{dispatch({type:'PLAYER_ATTACK_END'});const isCritical=Math.random()<state.player.critChance;let damage=calculateDamage(state.player,state.monster);if(damage===0){dispatch({type:'ADD_LOG',payload:{text:`${state.monster.name}é—ªé¿äº†${state.player.name}çš„æ”»å‡»ï¼`,isCritical:false}});}else{if(isCritical){damage=Math.floor(damage*state.player.critMultiplier);}dispatch({type:'MONSTER_DAMAGE',payload:{damage,isCritical}});}setTimeout(()=>{dispatch({type:'MONSTER_DAMAGE_END'});// æ€ªç‰©æ”»å‡» (å¦‚æœè¿˜æ´»ç€)\nif(state.monster.currentHealth>0){setTimeout(()=>{dispatch({type:'MONSTER_ATTACK'});setTimeout(()=>{dispatch({type:'MONSTER_ATTACK_END'});const monsterCritical=Math.random()<state.monster.critChance;let monsterDamage=calculateDamage(state.monster,state.player);if(monsterDamage===0){dispatch({type:'ADD_LOG',payload:{text:`${state.player.name}é—ªé¿äº†${state.monster.name}çš„æ”»å‡»ï¼`,isCritical:false}});}else{if(monsterCritical){monsterDamage=Math.floor(monsterDamage*state.monster.critMultiplier);}dispatch({type:'PLAYER_DAMAGE',payload:{damage:monsterDamage,isCritical:monsterCritical}});}setTimeout(()=>{dispatch({type:'PLAYER_DAMAGE_END'});},500);},500);},500);}},500);},500);},state.gameSpeed);return()=>clearInterval(gameLoop);},[state.gameScene,state.gameRunning,state.player,state.monster,state.selectedBattlefield]);const value={state,dispatch,calculateExpToNextLevel,equipmentTypes,rarities};return/*#__PURE__*/_jsx(GameContext.Provider,{value:value,children:children});}","map":{"version":3,"names":["React","createContext","useContext","useReducer","useEffect","jsx","_jsx","battlefields","id","name","levelRange","background","description","equipmentTypes","HEAD","emoji","slot","BODY","BELT","SHOES","WEAPON","NECKLACE","ACCESSORY","rarities","COMMON","color","chance","multiplier","UNCOMMON","RARE","EPIC","LEGENDARY","attributeTypes","HEALTH","min","max","scaling","ATTACK","DEFENSE","AGILITY","CRIT_CHANCE","equipmentAttributes","generateEquipment","playerLevel","dropRateBonus","arguments","length","undefined","equipLevel","Math","floor","random","equipTypeKeys","Object","keys","randomType","rarityRoll","selectedRarity","attrCount","possibleAttributes","shuffledAttributes","sort","selectedAttributes","slice","attributes","forEach","attrKey","attr","baseValue","levelScaling","value","round","prefixes","randomPrefix","Date","now","type","level","rarity","rarityName","rarityColor","generateMonster","battlefieldId","minLevel","maxLevel","battlefield","find","bf","monsterLevel","monsterTypes","baseHealth","baseAttack","baseDefense","baseAgility","availableMonsters","monsterType","levelMultiplier","maxHealth","currentHealth","attack","defense","agility","critChance","critMultiplier","expReward","dropChance","calculateExpToNextLevel","pow","calculateEquipmentStats","equipment","stats","health","values","equip","entries","_ref","key","createInitialState","savedState","localStorage","getItem","parsedState","JSON","parse","inventory","maxSlots","items","modal","isOpen","data","head","body","belt","shoes","weapon","necklace","accessory","e","console","error","gameScene","selectedBattlefield","player","experience","expToNextLevel","contextMenu","position","x","y","item","monster","battleLogs","playerAttacking","monsterAttacking","playerDamaged","monsterDamaged","gameSpeed","gameRunning","gameReducer","state","action","newState","payload","text","isCritical","existingEquipment","newInventory","filter","invItem","count","existingInvItem","i","push","newEquipment","equipStats","basePlayer","updatedPlayer","existingItem","damage","expGained","leveledUp","healthIncrease","newLogs","randomRoll","setItem","stringify","GameContext","useGame","GameProvider","_ref2","children","dispatch","calculateDamage","attacker","defender","baseDamage","agilityDiff","hitRateAdjustment","baseHitRate","hitRate","randomFactor","gameLoop","setInterval","setTimeout","monsterCritical","monsterDamage","clearInterval","Provider"],"sources":["D:/mm-rpg-react/src/contexts/GameContext.js"],"sourcesContent":["import React, { createContext, useContext, useReducer, useEffect } from 'react';\r\n\r\n// æˆ˜åœºé…ç½®\r\nconst battlefields = [\r\n    {\r\n        id: 'novice',\r\n        name: 'æ–°æ‰‹æ‘',\r\n        levelRange: [1, 10],\r\n        background: '#e6f7ff',\r\n        description: 'é€‚åˆ1-10çº§ç©å®¶çš„æ–°æ‰‹æˆ˜åœº'\r\n    },\r\n    {\r\n        id: 'intermediate',\r\n        name: 'è¿›é˜¶æ£®æ—',\r\n        levelRange: [11, 20],\r\n        background: '#e6ffe6',\r\n        description: 'é€‚åˆ11-20çº§ç©å®¶çš„è¿›é˜¶æˆ˜åœº'\r\n    },\r\n    {\r\n        id: 'hell',\r\n        name: 'åœ°ç‹±çº§éš¾åº¦',\r\n        levelRange: [21, 30],\r\n        background: '#ffe6e6',\r\n        description: 'é€‚åˆ21-30çº§ç©å®¶çš„é«˜éš¾åº¦æˆ˜åœº'\r\n    }\r\n];\r\n\r\n// è£…å¤‡ç±»å‹å®šä¹‰\r\nconst equipmentTypes = {\r\n    HEAD: { id: 'HEAD', name: 'å¤´éƒ¨', emoji: 'ğŸ§¢', slot: 'head' },\r\n    BODY: { id: 'BODY', name: 'èº«ä½“', emoji: 'ğŸ‘•', slot: 'body' },\r\n    BELT: { id: 'BELT', name: 'è…°å¸¦', emoji: 'ğŸ§¶', slot: 'belt' },\r\n    SHOES: { id: 'SHOES', name: 'é‹å­', emoji: 'ğŸ‘', slot: 'shoes' },\r\n    WEAPON: { id: 'WEAPON', name: 'æ­¦å™¨', emoji: 'ğŸ—¡ï¸', slot: 'weapon' },\r\n    NECKLACE: { id: 'NECKLACE', name: 'é¡¹é“¾', emoji: 'ğŸ“¿', slot: 'necklace' },\r\n    ACCESSORY: { id: 'ACCESSORY', name: 'é¦–é¥°', emoji: 'ğŸ’', slot: 'accessory' }\r\n};\r\n\r\n// è£…å¤‡ç¨€æœ‰åº¦å®šä¹‰\r\nconst rarities = {\r\n    COMMON: { id: 'COMMON', name: 'æ™®é€š', color: '#a0a0a0', chance: 0.6, multiplier: 1 },\r\n    UNCOMMON: { id: 'UNCOMMON', name: 'ä¼˜ç§€', color: '#1eff00', chance: 0.3, multiplier: 1.5 },\r\n    RARE: { id: 'RARE', name: 'ç²¾è‰¯', color: '#0070dd', chance: 0.08, multiplier: 2 },\r\n    EPIC: { id: 'EPIC', name: 'å²è¯—', color: '#a335ee', chance: 0.02, multiplier: 2.5 },\r\n    LEGENDARY: { id: 'LEGENDARY', name: 'ä¼ è¯´', color: '#ff8000', chance: 0.004, multiplier: 3 }\r\n};\r\n\r\n// è£…å¤‡å±æ€§å®šä¹‰\r\nconst attributeTypes = {\r\n    HEALTH: { id: 'HEALTH', name: 'ç”Ÿå‘½å€¼', min: 5, max: 20, scaling: 2 },\r\n    ATTACK: { id: 'ATTACK', name: 'æ”»å‡»åŠ›', min: 1, max: 5, scaling: 0.5 },\r\n    DEFENSE: { id: 'DEFENSE', name: 'é˜²å¾¡åŠ›', min: 1, max: 3, scaling: 0.3 },\r\n    AGILITY: { id: 'AGILITY', name: 'æ•æ·åº¦', min: 1, max: 3, scaling: 0.3 },\r\n    CRIT_CHANCE: { id: 'CRIT_CHANCE', name: 'æš´å‡»ç‡', min: 0.01, max: 0.03, scaling: 0.003 }\r\n};\r\n\r\n// æŒ‰è£…å¤‡ç±»å‹åˆ’åˆ†å¯èƒ½çš„å±æ€§ (æŸäº›å±æ€§åªåœ¨ç‰¹å®šè£…å¤‡ä¸Šå‡ºç°)\r\nconst equipmentAttributes = {\r\n    HEAD: ['HEALTH', 'DEFENSE'],\r\n    BODY: ['HEALTH', 'DEFENSE'],\r\n    BELT: ['HEALTH', 'AGILITY'],\r\n    SHOES: ['AGILITY', 'DEFENSE'],\r\n    WEAPON: ['ATTACK', 'CRIT_CHANCE'],\r\n    NECKLACE: ['HEALTH', 'CRIT_CHANCE'],\r\n    ACCESSORY: ['ATTACK', 'AGILITY', 'CRIT_CHANCE']\r\n};\r\n\r\n// éšæœºç”Ÿæˆè£…å¤‡\r\nconst generateEquipment = (playerLevel, dropRateBonus = 0) => {\r\n    // è£…å¤‡ç­‰çº§èŒƒå›´\r\n    const equipLevel = Math.max(1, Math.floor(playerLevel * (0.8 + Math.random() * 0.4)));\r\n\r\n    // éšæœºè£…å¤‡ç±»å‹\r\n    const equipTypeKeys = Object.keys(equipmentTypes);\r\n    const randomType = equipmentTypes[equipTypeKeys[Math.floor(Math.random() * equipTypeKeys.length)]];\r\n\r\n    // éšæœºç¨€æœ‰åº¦ (ä½¿ç”¨æ¦‚ç‡æƒé‡)\r\n    let rarityRoll = Math.random() - dropRateBonus; // æ‰è½ç‡åŠ æˆæé«˜ç¨€æœ‰åº¦æ¦‚ç‡\r\n    rarityRoll = Math.max(0, rarityRoll); // ç¡®ä¿ä¸ä¼šæ˜¯è´Ÿæ•°\r\n\r\n    let selectedRarity;\r\n    if (rarityRoll < rarities.LEGENDARY.chance) {\r\n        selectedRarity = rarities.LEGENDARY;\r\n    } else if (rarityRoll < rarities.EPIC.chance + rarities.LEGENDARY.chance) {\r\n        selectedRarity = rarities.EPIC;\r\n    } else if (rarityRoll < rarities.RARE.chance + rarities.EPIC.chance + rarities.LEGENDARY.chance) {\r\n        selectedRarity = rarities.RARE;\r\n    } else if (rarityRoll < rarities.UNCOMMON.chance + rarities.RARE.chance + rarities.EPIC.chance + rarities.LEGENDARY.chance) {\r\n        selectedRarity = rarities.UNCOMMON;\r\n    } else {\r\n        selectedRarity = rarities.COMMON;\r\n    }\r\n\r\n    // ç¡®å®šå±æ€§æ•°é‡ (åŸºäºç¨€æœ‰åº¦)\r\n    const attrCount = Math.floor(Math.random() * 2) + 1; // 1-2ä¸ªå±æ€§\r\n\r\n    // éšæœºé€‰æ‹©å±æ€§\r\n    const possibleAttributes = equipmentAttributes[randomType.id];\r\n    const shuffledAttributes = [...possibleAttributes].sort(() => 0.5 - Math.random());\r\n    const selectedAttributes = shuffledAttributes.slice(0, attrCount);\r\n\r\n    // ä¸ºæ¯ä¸ªå±æ€§éšæœºç”Ÿæˆæ•°å€¼\r\n    const attributes = {};\r\n    selectedAttributes.forEach(attrKey => {\r\n        const attr = attributeTypes[attrKey];\r\n        // åŸºç¡€å±æ€§å€¼ + ç­‰çº§ç¼©æ”¾ * ç¨€æœ‰åº¦å€ç‡\r\n        const baseValue = attr.min + Math.random() * (attr.max - attr.min);\r\n        const levelScaling = attr.scaling * equipLevel;\r\n        let value = (baseValue + levelScaling) * selectedRarity.multiplier;\r\n\r\n        // å¯¹æš´å‡»ç‡è¿›è¡Œç‰¹æ®Šå¤„ç†ï¼Œç¡®ä¿ä¸è¶…è¿‡åˆç†èŒƒå›´\r\n        if (attrKey === 'CRIT_CHANCE') {\r\n            value = Math.min(value, 0.25); // æœ€é«˜25%æš´å‡»ç‡\r\n            value = Math.round(value * 1000) / 1000; // ä¿ç•™3ä½å°æ•°\r\n        } else {\r\n            value = Math.floor(value); // å…¶ä»–å±æ€§å–æ•´\r\n        }\r\n\r\n        attributes[attrKey] = value;\r\n    });\r\n\r\n    // ç”Ÿæˆè£…å¤‡åç§°\r\n    const prefixes = [\r\n        'é”‹åˆ©çš„', 'åšå›ºçš„', 'é—ªäº®çš„', 'ç ´æ—§çš„', 'ç¥ç§˜çš„',\r\n        'å¤è€çš„', 'å¼ºåŒ–çš„', 'ç²¾åˆ¶çš„', 'é­”æ³•çš„', 'ä¼ æ‰¿çš„'\r\n    ];\r\n    const randomPrefix = prefixes[Math.floor(Math.random() * prefixes.length)];\r\n    const name = `${randomPrefix} ${randomType.name}`;\r\n\r\n    // ç”Ÿæˆå”¯ä¸€ID\r\n    const id = `equip_${Date.now()}_${Math.floor(Math.random() * 1000)}`;\r\n\r\n    return {\r\n        id,\r\n        name,\r\n        type: randomType.id,\r\n        emoji: randomType.emoji,\r\n        slot: randomType.slot,\r\n        level: equipLevel,\r\n        rarity: selectedRarity.id,\r\n        rarityName: selectedRarity.name,\r\n        rarityColor: selectedRarity.color,\r\n        attributes\r\n    };\r\n};\r\n\r\n// æ€ªç‰©é…ç½®ï¼ˆæ ¹æ®ç­‰çº§ç”Ÿæˆï¼‰\r\nconst generateMonster = (playerLevel, battlefieldId) => {\r\n    // æ ¹æ®æˆ˜åœºç¡®å®šæ€ªç‰©ç­‰çº§èŒƒå›´\r\n    let minLevel = playerLevel - 2;\r\n    let maxLevel = playerLevel + 2;\r\n    const battlefield = battlefields.find(bf => bf.id === battlefieldId);\r\n\r\n    // ç¡®ä¿æ€ªç‰©ç­‰çº§åœ¨æˆ˜åœºèŒƒå›´å†…\r\n    if (battlefield) {\r\n        minLevel = Math.max(minLevel, battlefield.levelRange[0]);\r\n        maxLevel = Math.min(maxLevel, battlefield.levelRange[1]);\r\n    }\r\n\r\n    // éšæœºç¡®å®šæ€ªç‰©ç­‰çº§\r\n    const monsterLevel = Math.floor(Math.random() * (maxLevel - minLevel + 1)) + minLevel;\r\n\r\n    // æ€ªç‰©ç±»å‹\r\n    const monsterTypes = [\r\n        { name: 'å²è±å§†', emoji: 'ğŸŸ¢', baseHealth: 50, baseAttack: 5, baseDefense: 2, baseAgility: 1 },\r\n        { name: 'è™è ', emoji: 'ğŸ¦‡', baseHealth: 40, baseAttack: 7, baseDefense: 1, baseAgility: 5 },\r\n        { name: 'éª·é«…', emoji: 'ğŸ’€', baseHealth: 60, baseAttack: 6, baseDefense: 3, baseAgility: 2 },\r\n        { name: 'èœ˜è››', emoji: 'ğŸ•·ï¸', baseHealth: 45, baseAttack: 6, baseDefense: 2, baseAgility: 4 },\r\n        { name: 'å¹½çµ', emoji: 'ğŸ‘»', baseHealth: 55, baseAttack: 8, baseDefense: 0, baseAgility: 6 },\r\n        { name: 'å·¨é­”', emoji: 'ğŸ‘¹', baseHealth: 70, baseAttack: 9, baseDefense: 4, baseAgility: 1 },\r\n        { name: 'æ¶é­”', emoji: 'ğŸ˜ˆ', baseHealth: 65, baseAttack: 10, baseDefense: 3, baseAgility: 3 }\r\n    ];\r\n\r\n    // æ ¹æ®æˆ˜åœºéš¾åº¦é€‰æ‹©æ€ªç‰©\r\n    let availableMonsters;\r\n    if (battlefieldId === 'novice') {\r\n        availableMonsters = monsterTypes.slice(0, 3); // ç®€å•æ€ªç‰©\r\n    } else if (battlefieldId === 'intermediate') {\r\n        availableMonsters = monsterTypes.slice(2, 5); // ä¸­ç­‰æ€ªç‰©\r\n    } else {\r\n        availableMonsters = monsterTypes.slice(4); // å›°éš¾æ€ªç‰©\r\n    }\r\n\r\n    // éšæœºé€‰æ‹©ä¸€ç§æ€ªç‰©\r\n    const monsterType = availableMonsters[Math.floor(Math.random() * availableMonsters.length)];\r\n\r\n    // åŸºäºç­‰çº§è®¡ç®—æ€ªç‰©å±æ€§\r\n    const levelMultiplier = 1 + (monsterLevel - 1) * 0.1; // æ¯çº§æå‡10%\r\n\r\n    return {\r\n        name: `${monsterLevel}çº§${monsterType.name}`,\r\n        emoji: monsterType.emoji,\r\n        level: monsterLevel,\r\n        maxHealth: Math.floor(monsterType.baseHealth * levelMultiplier),\r\n        currentHealth: Math.floor(monsterType.baseHealth * levelMultiplier),\r\n        attack: Math.floor(monsterType.baseAttack * levelMultiplier),\r\n        defense: Math.floor(monsterType.baseDefense * levelMultiplier),\r\n        agility: Math.floor(monsterType.baseAgility * levelMultiplier),\r\n        critChance: 0.1 + monsterLevel * 0.005, // åŸºç¡€10%ï¼Œæ¯çº§+0.5%\r\n        critMultiplier: 1.5,\r\n        // æ€ªç‰©ç»éªŒå€¼ï¼šåŸºç¡€å€¼ + ç­‰çº§åŠ æˆ\r\n        expReward: 10 + monsterLevel * 5,\r\n        // æ‰è½è£…å¤‡æ¦‚ç‡ (20% + ç­‰çº§åŠ æˆ)\r\n        dropChance: 0.2 + monsterLevel * 0.01\r\n    };\r\n};\r\n\r\n// è®¡ç®—å‡çº§æ‰€éœ€ç»éªŒ\r\nconst calculateExpToNextLevel = (level) => {\r\n    // ä½¿ç”¨æŒ‡æ•°å¢é•¿å…¬å¼: 100 * (level)^1.5\r\n    return Math.floor(100 * Math.pow(level, 1.5));\r\n};\r\n\r\n// è®¡ç®—è£…å¤‡æä¾›çš„å±æ€§æ€»å’Œ\r\nconst calculateEquipmentStats = (equipment) => {\r\n    const stats = {\r\n        health: 0,\r\n        attack: 0,\r\n        defense: 0,\r\n        agility: 0,\r\n        critChance: 0\r\n    };\r\n\r\n    // éå†æ‰€æœ‰è£…å¤‡æ§½ä½\r\n    Object.values(equipment).forEach(equip => {\r\n        if (!equip) return; // å¦‚æœæ§½ä½æ²¡æœ‰è£…å¤‡\r\n\r\n        // ç´¯åŠ è£…å¤‡å±æ€§\r\n        Object.entries(equip.attributes).forEach(([key, value]) => {\r\n            switch (key) {\r\n                case 'HEALTH':\r\n                    stats.health += value;\r\n                    break;\r\n                case 'ATTACK':\r\n                    stats.attack += value;\r\n                    break;\r\n                case 'DEFENSE':\r\n                    stats.defense += value;\r\n                    break;\r\n                case 'AGILITY':\r\n                    stats.agility += value;\r\n                    break;\r\n                case 'CRIT_CHANCE':\r\n                    stats.critChance += value;\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n        });\r\n    });\r\n\r\n    return stats;\r\n};\r\n\r\n// åˆå§‹çŠ¶æ€\r\n// åˆå§‹çŠ¶æ€\r\nconst createInitialState = () => {\r\n    try {\r\n        // å°è¯•ä»localStorageè¯»å–ä¿å­˜çš„çŠ¶æ€\r\n        const savedState = localStorage.getItem('rpgGameState');\r\n        if (savedState) {\r\n            const parsedState = JSON.parse(savedState);\r\n\r\n            // æ£€æŸ¥å¹¶ç¡®ä¿æ‰€æœ‰å…³é”®å±æ€§éƒ½å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™ä½¿ç”¨é»˜è®¤å€¼\r\n            // ç¡®ä¿inventoryå­˜åœ¨\r\n            if (!parsedState.inventory) {\r\n                parsedState.inventory = {\r\n                    maxSlots: 20,\r\n                    items: []\r\n                };\r\n            }\r\n\r\n            // ç¡®ä¿modalå­˜åœ¨\r\n            if (!parsedState.modal) {\r\n                parsedState.modal = {\r\n                    isOpen: false,\r\n                    type: null,\r\n                    data: null\r\n                };\r\n            }\r\n\r\n            // ç¡®ä¿equipmentå­˜åœ¨\r\n            if (!parsedState.equipment) {\r\n                parsedState.equipment = {\r\n                    head: null,\r\n                    body: null,\r\n                    belt: null,\r\n                    shoes: null,\r\n                    weapon: null,\r\n                    necklace: null,\r\n                    accessory: null\r\n                };\r\n            }\r\n\r\n            return parsedState;\r\n        }\r\n    } catch (e) {\r\n        console.error('Failed to parse saved game state:', e);\r\n    }\r\n\r\n    // é»˜è®¤åˆå§‹çŠ¶æ€\r\n    return {\r\n        // æ¸¸æˆåœºæ™¯çŠ¶æ€: 'select' - æˆ˜åœºé€‰æ‹©é¡µé¢, 'battle' - æˆ˜æ–—é¡µé¢\r\n        gameScene: 'select',\r\n        selectedBattlefield: null,\r\n\r\n        // è§’è‰²åŸºç¡€å±æ€§\r\n        player: {\r\n            name: \"å‹‡è€…\",\r\n            level: 1,\r\n            experience: 0,\r\n            expToNextLevel: calculateExpToNextLevel(1),\r\n            maxHealth: 100,\r\n            currentHealth: 100,\r\n            attack: 10,\r\n            defense: 5,\r\n            agility: 3, // æ–°å¢æ•æ·åº¦å±æ€§\r\n            critChance: 0.1,\r\n            critMultiplier: 1.5\r\n        },\r\n\r\n        // è£…å¤‡ç³»ç»Ÿ\r\n        equipment: {\r\n            head: null,\r\n            body: null,\r\n            belt: null,\r\n            shoes: null,\r\n            weapon: null,\r\n            necklace: null,\r\n            accessory: null\r\n        },\r\n\r\n        // ç‰©å“æ \r\n        inventory: {\r\n            maxSlots: 20, // ç‰©å“æ æœ€å¤§æ ¼å­æ•°\r\n            items: [] // ç‰©å“åˆ—è¡¨ï¼Œæ¯ä¸ªç‰©å“åŒ…å« {id, count, ...itemData}\r\n        },\r\n\r\n        // æ¨¡æ€çª—å£çŠ¶æ€\r\n        modal: {\r\n            isOpen: false,\r\n            type: null, // 'character', 'equipment', 'inventory'\r\n            data: null\r\n        },\r\n\r\n        // ç‰©å“å³é”®èœå•çŠ¶æ€\r\n        contextMenu: {\r\n            isOpen: false,\r\n            position: { x: 0, y: 0 },\r\n            item: null\r\n        },\r\n\r\n        monster: null,\r\n\r\n        battleLogs: [],\r\n        playerAttacking: false,\r\n        monsterAttacking: false,\r\n        playerDamaged: false,\r\n        monsterDamaged: false,\r\n        gameSpeed: 2000, // æ¯å›åˆé—´éš”(æ¯«ç§’)\r\n        gameRunning: true,\r\n        battlefields: battlefields\r\n    };\r\n};\r\n\r\n// Reducerå‡½æ•°æ¥å¤„ç†çŠ¶æ€æ›´æ–°\r\nfunction gameReducer(state, action) {\r\n    let newState;\r\n\r\n    switch (action.type) {\r\n        // é€‰æ‹©æˆ˜åœº\r\n        case 'SELECT_BATTLEFIELD':\r\n            newState = {\r\n                ...state,\r\n                gameScene: 'battle',\r\n                selectedBattlefield: action.payload,\r\n                battleLogs: [{\r\n                    id: Date.now(),\r\n                    text: `è¿›å…¥${action.payload.name}æˆ˜åœºï¼`,\r\n                    isCritical: false\r\n                }],\r\n                // ç”Ÿæˆæ–°æ€ªç‰©\r\n                monster: generateMonster(state.player.level, action.payload.id)\r\n            };\r\n            break;\r\n\r\n        // è¿”å›é€‰æ‹©é¡µé¢\r\n        case 'RETURN_TO_SELECT':\r\n            newState = {\r\n                ...state,\r\n                gameScene: 'select',\r\n                monster: null,\r\n                battleLogs: []\r\n            };\r\n            break;\r\n\r\n        // æ‰“å¼€æ¨¡æ€çª—å£\r\n        case 'OPEN_MODAL':\r\n            newState = {\r\n                ...state,\r\n                modal: {\r\n                    isOpen: true,\r\n                    type: action.payload.type,\r\n                    data: action.payload.data || null\r\n                }\r\n            };\r\n            break;\r\n\r\n        // å…³é—­æ¨¡æ€çª—å£\r\n        case 'CLOSE_MODAL':\r\n            newState = {\r\n                ...state,\r\n                modal: {\r\n                    ...state.modal,\r\n                    isOpen: false\r\n                }\r\n            };\r\n            break;\r\n\r\n        // æ‰“å¼€å³é”®èœå•\r\n        case 'OPEN_CONTEXT_MENU':\r\n            newState = {\r\n                ...state,\r\n                contextMenu: {\r\n                    isOpen: true,\r\n                    position: action.payload.position,\r\n                    item: action.payload.item\r\n                }\r\n            };\r\n            break;\r\n\r\n        // å…³é—­å³é”®èœå•\r\n        case 'CLOSE_CONTEXT_MENU':\r\n            newState = {\r\n                ...state,\r\n                contextMenu: {\r\n                    ...state.contextMenu,\r\n                    isOpen: false\r\n                }\r\n            };\r\n            break;\r\n\r\n        // è£…å¤‡ç‰©å“\r\n        case 'EQUIP_ITEM':\r\n            {\r\n                const item = action.payload;\r\n                const { slot } = item;\r\n\r\n                // æ£€æŸ¥æ˜¯å¦å·²ç»æœ‰è£…å¤‡åœ¨è¯¥æ§½ä½\r\n                const existingEquipment = state.equipment[slot];\r\n                let newInventory = { ...state.inventory };\r\n\r\n                // ä»ç‰©å“æ ç§»é™¤è¦è£…å¤‡çš„ç‰©å“\r\n                newInventory.items = newInventory.items.filter(invItem => {\r\n                    if (invItem.id === item.id) {\r\n                        if (invItem.count > 1) {\r\n                            invItem.count--;\r\n                            return true;\r\n                        }\r\n                        return false;\r\n                    }\r\n                    return true;\r\n                });\r\n\r\n                // å¦‚æœæ§½ä½å·²æœ‰è£…å¤‡ï¼Œå°†å…¶æ”¾å›ç‰©å“æ \r\n                if (existingEquipment) {\r\n                    // æ£€æŸ¥ç‰©å“æ æ˜¯å¦å·²æœ‰ç›¸åŒç‰©å“\r\n                    const existingInvItem = newInventory.items.find(i =>\r\n                        i.id === existingEquipment.id ||\r\n                        (i.name === existingEquipment.name && i.level === existingEquipment.level)\r\n                    );\r\n\r\n                    if (existingInvItem) {\r\n                        existingInvItem.count++;\r\n                    } else {\r\n                        // æ£€æŸ¥ç‰©å“æ æ˜¯å¦å·²æ»¡\r\n                        if (newInventory.items.length < newInventory.maxSlots) {\r\n                            newInventory.items.push({ ...existingEquipment, count: 1 });\r\n                        } else {\r\n                            // å¦‚æœæ»¡äº†ï¼Œæ·»åŠ æç¤º\r\n                            newState = {\r\n                                ...state,\r\n                                battleLogs: [\r\n                                    {\r\n                                        id: Date.now(),\r\n                                        text: `ç‰©å“æ å·²æ»¡ï¼Œæ— æ³•å¸ä¸‹${existingEquipment.name}ï¼`,\r\n                                        isCritical: true\r\n                                    },\r\n                                    ...state.battleLogs.slice(0, 19)\r\n                                ]\r\n                            };\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n\r\n                // åˆ›å»ºæ–°çš„è£…å¤‡çŠ¶æ€\r\n                const newEquipment = {\r\n                    ...state.equipment,\r\n                    [slot]: { ...item, count: 1 }\r\n                };\r\n\r\n                // è·å–æ–°çš„è£…å¤‡åŠ æˆ\r\n                const equipStats = calculateEquipmentStats(newEquipment);\r\n\r\n                // æ›´æ–°ç©å®¶å±æ€§ï¼ˆåŸºç¡€å±æ€§+è£…å¤‡åŠ æˆï¼‰\r\n                const basePlayer = { ...state.player };\r\n                const updatedPlayer = {\r\n                    ...basePlayer,\r\n                    maxHealth: basePlayer.maxHealth + equipStats.health,\r\n                    currentHealth: Math.min(basePlayer.currentHealth + equipStats.health, basePlayer.maxHealth + equipStats.health),\r\n                    attack: basePlayer.attack + equipStats.attack,\r\n                    defense: basePlayer.defense + equipStats.defense,\r\n                    agility: basePlayer.agility + equipStats.agility,\r\n                    critChance: basePlayer.critChance + equipStats.critChance\r\n                };\r\n\r\n                newState = {\r\n                    ...state,\r\n                    equipment: newEquipment,\r\n                    inventory: newInventory,\r\n                    player: updatedPlayer,\r\n                    battleLogs: [\r\n                        {\r\n                            id: Date.now(),\r\n                            text: `è£…å¤‡äº†${item.name}ï¼`,\r\n                            isCritical: false\r\n                        },\r\n                        ...state.battleLogs.slice(0, 19)\r\n                    ]\r\n                };\r\n            }\r\n            break;\r\n\r\n        // å¸ä¸‹è£…å¤‡\r\n        case 'UNEQUIP_ITEM':\r\n            {\r\n                const slot = action.payload;\r\n                const item = state.equipment[slot];\r\n\r\n                if (!item) {\r\n                    newState = state;\r\n                    break;\r\n                }\r\n\r\n                // æ£€æŸ¥ç‰©å“æ æ˜¯å¦å·²æ»¡\r\n                if (state.inventory.items.length >= state.inventory.maxSlots) {\r\n                    newState = {\r\n                        ...state,\r\n                        battleLogs: [\r\n                            {\r\n                                id: Date.now(),\r\n                                text: `ç‰©å“æ å·²æ»¡ï¼Œæ— æ³•å¸ä¸‹${item.name}ï¼`,\r\n                                isCritical: true\r\n                            },\r\n                            ...state.battleLogs.slice(0, 19)\r\n                        ]\r\n                    };\r\n                    break;\r\n                }\r\n\r\n                // æ£€æŸ¥ç‰©å“æ æ˜¯å¦å·²æœ‰ç›¸åŒç‰©å“\r\n                let newInventory = { ...state.inventory };\r\n                const existingItem = newInventory.items.find(i =>\r\n                    i.id === item.id ||\r\n                    (i.name === item.name && i.level === item.level)\r\n                );\r\n\r\n                if (existingItem) {\r\n                    existingItem.count++;\r\n                } else {\r\n                    newInventory.items.push({ ...item, count: 1 });\r\n                }\r\n\r\n                // åˆ›å»ºæ–°çš„è£…å¤‡çŠ¶æ€\r\n                const newEquipment = {\r\n                    ...state.equipment,\r\n                    [slot]: null\r\n                };\r\n\r\n                // è·å–æ–°çš„è£…å¤‡åŠ æˆ\r\n                const equipStats = calculateEquipmentStats(newEquipment);\r\n\r\n                // æ›´æ–°ç©å®¶å±æ€§ï¼ˆåŸºç¡€å±æ€§+è£…å¤‡åŠ æˆï¼‰\r\n                const basePlayer = { ...state.player };\r\n                const updatedPlayer = {\r\n                    ...basePlayer,\r\n                    maxHealth: basePlayer.maxHealth - equipStats.health,\r\n                    currentHealth: Math.min(basePlayer.currentHealth, basePlayer.maxHealth - equipStats.health),\r\n                    attack: basePlayer.attack - equipStats.attack,\r\n                    defense: basePlayer.defense - equipStats.defense,\r\n                    agility: basePlayer.agility - equipStats.agility,\r\n                    critChance: basePlayer.critChance - equipStats.critChance\r\n                };\r\n\r\n                newState = {\r\n                    ...state,\r\n                    equipment: newEquipment,\r\n                    inventory: newInventory,\r\n                    player: updatedPlayer,\r\n                    battleLogs: [\r\n                        {\r\n                            id: Date.now(),\r\n                            text: `å¸ä¸‹äº†${item.name}ï¼`,\r\n                            isCritical: false\r\n                        },\r\n                        ...state.battleLogs.slice(0, 19)\r\n                    ]\r\n                };\r\n            }\r\n            break;\r\n\r\n        // ä¸¢å¼ƒç‰©å“\r\n        case 'DISCARD_ITEM':\r\n            {\r\n                const item = action.payload;\r\n\r\n                // ä»ç‰©å“æ ç§»é™¤ç‰©å“\r\n                const newInventory = { ...state.inventory };\r\n                newInventory.items = newInventory.items.filter(invItem => invItem.id !== item.id);\r\n\r\n                newState = {\r\n                    ...state,\r\n                    inventory: newInventory,\r\n                    battleLogs: [\r\n                        {\r\n                            id: Date.now(),\r\n                            text: `ä¸¢å¼ƒäº†${item.name} x${item.count}ï¼`,\r\n                            isCritical: false\r\n                        },\r\n                        ...state.battleLogs.slice(0, 19)\r\n                    ]\r\n                };\r\n            }\r\n            break;\r\n\r\n        // è·å¾—ç‰©å“\r\n        case 'GAIN_ITEM':\r\n            {\r\n                const item = action.payload;\r\n\r\n                // æ£€æŸ¥ç‰©å“æ æ˜¯å¦å·²æ»¡\r\n                if (state.inventory.items.length >= state.inventory.maxSlots) {\r\n                    // ç‰©å“æ å·²æ»¡ï¼Œæ— æ³•è·å¾—ç‰©å“\r\n                    newState = {\r\n                        ...state,\r\n                        battleLogs: [\r\n                            {\r\n                                id: Date.now(),\r\n                                text: `ç‰©å“æ å·²æ»¡ï¼Œæ— æ³•è·å¾—${item.name}ï¼`,\r\n                                isCritical: true\r\n                            },\r\n                            ...state.battleLogs.slice(0, 19)\r\n                        ]\r\n                    };\r\n                    break;\r\n                }\r\n\r\n                // æ£€æŸ¥ç‰©å“æ æ˜¯å¦å·²æœ‰ç›¸åŒç‰©å“\r\n                const newInventory = { ...state.inventory };\r\n                const existingItem = newInventory.items.find(i =>\r\n                    i.id === item.id ||\r\n                    (i.name === item.name && i.level === item.level && i.rarity === item.rarity)\r\n                );\r\n\r\n                if (existingItem) {\r\n                    // å¦‚æœå·²æœ‰ç›¸åŒç‰©å“ï¼Œå¢åŠ æ•°é‡\r\n                    existingItem.count++;\r\n                } else {\r\n                    // å¦åˆ™æ·»åŠ æ–°ç‰©å“\r\n                    newInventory.items.push({ ...item, count: 1 });\r\n                }\r\n\r\n                newState = {\r\n                    ...state,\r\n                    inventory: newInventory,\r\n                    battleLogs: [\r\n                        {\r\n                            id: Date.now(),\r\n                            text: `è·å¾—äº†${item.name}ï¼`,\r\n                            isCritical: false\r\n                        },\r\n                        ...state.battleLogs.slice(0, 19)\r\n                    ]\r\n                };\r\n            }\r\n            break;\r\n\r\n        // ç©å®¶æ”»å‡»\r\n        case 'PLAYER_ATTACK':\r\n            newState = {\r\n                ...state,\r\n                playerAttacking: true\r\n            };\r\n            break;\r\n\r\n        // ç©å®¶æ”»å‡»ç»“æŸ\r\n        case 'PLAYER_ATTACK_END':\r\n            newState = {\r\n                ...state,\r\n                playerAttacking: false\r\n            };\r\n            break;\r\n\r\n        // æ€ªç‰©å—ä¼¤\r\n        case 'MONSTER_DAMAGE':\r\n            newState = {\r\n                ...state,\r\n                monsterDamaged: true,\r\n                monster: {\r\n                    ...state.monster,\r\n                    currentHealth: Math.max(0, state.monster.currentHealth - action.payload.damage)\r\n                },\r\n                battleLogs: [\r\n                    {\r\n                        id: Date.now(),\r\n                        text: action.payload.isCritical\r\n                            ? `æš´å‡»ï¼${state.player.name}å¯¹${state.monster.name}é€ æˆäº†${action.payload.damage}ç‚¹ä¼¤å®³ï¼`\r\n                            : `${state.player.name}å¯¹${state.monster.name}é€ æˆäº†${action.payload.damage}ç‚¹ä¼¤å®³ã€‚`,\r\n                        isCritical: action.payload.isCritical\r\n                    },\r\n                    ...state.battleLogs.slice(0, 19)\r\n                ]\r\n            };\r\n            break;\r\n\r\n        // æ€ªç‰©å—ä¼¤ç»“æŸ\r\n        case 'MONSTER_DAMAGE_END':\r\n            newState = {\r\n                ...state,\r\n                monsterDamaged: false\r\n            };\r\n            break;\r\n\r\n        // æ€ªç‰©æ”»å‡»\r\n        case 'MONSTER_ATTACK':\r\n            newState = {\r\n                ...state,\r\n                monsterAttacking: true\r\n            };\r\n            break;\r\n\r\n        // æ€ªç‰©æ”»å‡»ç»“æŸ\r\n        case 'MONSTER_ATTACK_END':\r\n            newState = {\r\n                ...state,\r\n                monsterAttacking: false\r\n            };\r\n            break;\r\n\r\n        // ç©å®¶å—ä¼¤\r\n        case 'PLAYER_DAMAGE':\r\n            newState = {\r\n                ...state,\r\n                playerDamaged: true,\r\n                player: {\r\n                    ...state.player,\r\n                    currentHealth: Math.max(0, state.player.currentHealth - action.payload.damage)\r\n                },\r\n                battleLogs: [\r\n                    {\r\n                        id: Date.now(),\r\n                        text: action.payload.isCritical\r\n                            ? `æš´å‡»ï¼${state.monster.name}å¯¹${state.player.name}é€ æˆäº†${action.payload.damage}ç‚¹ä¼¤å®³ï¼`\r\n                            : `${state.monster.name}å¯¹${state.player.name}é€ æˆäº†${action.payload.damage}ç‚¹ä¼¤å®³ã€‚`,\r\n                        isCritical: action.payload.isCritical\r\n                    },\r\n                    ...state.battleLogs.slice(0, 19)\r\n                ]\r\n            };\r\n            break;\r\n\r\n        // ç©å®¶å—ä¼¤ç»“æŸ\r\n        case 'PLAYER_DAMAGE_END':\r\n            newState = {\r\n                ...state,\r\n                playerDamaged: false\r\n            };\r\n            break;\r\n\r\n        // æ·»åŠ æ—¥å¿—\r\n        case 'ADD_LOG':\r\n            newState = {\r\n                ...state,\r\n                battleLogs: [\r\n                    { id: Date.now(), text: action.payload.text, isCritical: action.payload.isCritical },\r\n                    ...state.battleLogs.slice(0, 19)\r\n                ]\r\n            };\r\n            break;\r\n\r\n        // ç©å®¶è·å¾—ç»éªŒ\r\n        case 'PLAYER_GAIN_EXPERIENCE':\r\n            {\r\n                const expGained = action.payload.experience;\r\n                let updatedPlayer = { ...state.player };\r\n                updatedPlayer.experience += expGained;\r\n\r\n                // æ£€æŸ¥æ˜¯å¦å‡çº§\r\n                let leveledUp = false;\r\n                while (updatedPlayer.experience >= updatedPlayer.expToNextLevel) {\r\n                    // å‡çº§\r\n                    updatedPlayer.level += 1;\r\n                    updatedPlayer.experience -= updatedPlayer.expToNextLevel;\r\n                    updatedPlayer.expToNextLevel = calculateExpToNextLevel(updatedPlayer.level);\r\n\r\n                    // å±æ€§æå‡\r\n                    const healthIncrease = Math.floor(20 + updatedPlayer.level * 5);\r\n                    updatedPlayer.maxHealth += healthIncrease;\r\n                    updatedPlayer.currentHealth += healthIncrease;\r\n                    updatedPlayer.attack += 2;\r\n                    updatedPlayer.defense += 1;\r\n                    updatedPlayer.agility += 1;\r\n\r\n                    // æ¯10çº§å¢åŠ æš´å‡»ç‡\r\n                    if (updatedPlayer.level % 10 === 0) {\r\n                        updatedPlayer.critChance += 0.05;\r\n                    }\r\n\r\n                    leveledUp = true;\r\n                }\r\n\r\n                const newLogs = leveledUp\r\n                    ? [\r\n                        {\r\n                            id: Date.now(),\r\n                            text: `è·å¾—${expGained}ç‚¹ç»éªŒï¼å‡çº§åˆ°${updatedPlayer.level}çº§ï¼`,\r\n                            isCritical: true\r\n                        },\r\n                        ...state.battleLogs\r\n                    ]\r\n                    : [\r\n                        {\r\n                            id: Date.now(),\r\n                            text: `è·å¾—${expGained}ç‚¹ç»éªŒï¼`,\r\n                            isCritical: false\r\n                        },\r\n                        ...state.battleLogs\r\n                    ];\r\n\r\n                newState = {\r\n                    ...state,\r\n                    player: updatedPlayer,\r\n                    battleLogs: newLogs.slice(0, 20)\r\n                };\r\n            }\r\n            break;\r\n\r\n        // æ‰è½è£…å¤‡\r\n        case 'DROP_EQUIPMENT':\r\n            {\r\n                // æ£€æŸ¥æ˜¯å¦æ‰è½è£…å¤‡\r\n                const monster = state.monster;\r\n                const randomRoll = Math.random();\r\n\r\n                if (randomRoll <= monster.dropChance) {\r\n                    // ç”Ÿæˆè£…å¤‡\r\n                    const equipment = generateEquipment(monster.level);\r\n\r\n                    // æ£€æŸ¥ç‰©å“æ æ˜¯å¦å·²æ»¡\r\n                    if (state.inventory.items.length >= state.inventory.maxSlots) {\r\n                        // ç‰©å“æ å·²æ»¡ï¼Œæ— æ³•è·å¾—è£…å¤‡\r\n                        newState = {\r\n                            ...state,\r\n                            battleLogs: [\r\n                                {\r\n                                    id: Date.now(),\r\n                                    text: `æ€ªç‰©æ‰è½äº†${equipment.rarityName}å“è´¨çš„${equipment.name}ï¼Œä½†ç‰©å“æ å·²æ»¡ï¼Œæ— æ³•æ‹¾å–ï¼`,\r\n                                    isCritical: true\r\n                                },\r\n                                ...state.battleLogs.slice(0, 19)\r\n                            ]\r\n                        };\r\n                        break;\r\n                    }\r\n\r\n                    // æ·»åŠ è£…å¤‡åˆ°ç‰©å“æ \r\n                    const newInventory = { ...state.inventory };\r\n                    newInventory.items.push({ ...equipment, count: 1 });\r\n\r\n                    newState = {\r\n                        ...state,\r\n                        inventory: newInventory,\r\n                        battleLogs: [\r\n                            {\r\n                                id: Date.now(),\r\n                                text: `æ€ªç‰©æ‰è½äº†${equipment.rarityName}å“è´¨çš„${equipment.name}ï¼`,\r\n                                isCritical: true\r\n                            },\r\n                            ...state.battleLogs.slice(0, 19)\r\n                        ]\r\n                    };\r\n                } else {\r\n                    // æ²¡æœ‰æ‰è½è£…å¤‡\r\n                    newState = state;\r\n                }\r\n            }\r\n            break;\r\n\r\n        // é‡ç½®æ€ªç‰©\r\n        case 'RESET_MONSTER':\r\n            newState = {\r\n                ...state,\r\n                monster: generateMonster(state.player.level, state.selectedBattlefield.id),\r\n                battleLogs: [\r\n                    { id: Date.now(), text: \"æ–°çš„æ€ªç‰©å‡ºç°äº†ï¼\", isCritical: false },\r\n                    ...state.battleLogs.slice(0, 19)\r\n                ]\r\n            };\r\n            break;\r\n\r\n        // æ¢å¤ç©å®¶ç”Ÿå‘½å€¼\r\n        case 'RESET_PLAYER_HEALTH':\r\n            newState = {\r\n                ...state,\r\n                player: {\r\n                    ...state.player,\r\n                    currentHealth: state.player.maxHealth\r\n                },\r\n                battleLogs: [\r\n                    { id: Date.now(), text: `${state.player.name}æ¢å¤äº†å¥åº·ï¼`, isCritical: false },\r\n                    ...state.battleLogs.slice(0, 19)\r\n                ]\r\n            };\r\n            break;\r\n\r\n        // åˆ‡æ¢æ¸¸æˆè¿è¡ŒçŠ¶æ€\r\n        case 'TOGGLE_GAME':\r\n            newState = {\r\n                ...state,\r\n                gameRunning: !state.gameRunning\r\n            };\r\n            break;\r\n\r\n        default:\r\n            return state;\r\n    }\r\n\r\n    // ä¿å­˜çŠ¶æ€åˆ°localStorage\r\n    localStorage.setItem('rpgGameState', JSON.stringify(newState));\r\n    return newState;\r\n}\r\n\r\n// åˆ›å»ºContext\r\nconst GameContext = createContext();\r\n\r\n// è‡ªå®šä¹‰é’©å­ï¼Œæ–¹ä¾¿ç»„ä»¶ä½¿ç”¨Context\r\nexport function useGame() {\r\n    return useContext(GameContext);\r\n}\r\n\r\n// Providerç»„ä»¶\r\nexport function GameProvider({ children }) {\r\n    const [state, dispatch] = useReducer(gameReducer, null, createInitialState);\r\n\r\n    // æˆ˜æ–—ä¼¤å®³è®¡ç®—\r\n    const calculateDamage = (attacker, defender) => {\r\n        // åŸºç¡€ä¼¤å®³ = æ”»å‡»åŠ› - é˜²å¾¡åŠ›/2\r\n        let baseDamage = Math.max(1, attacker.attack - defender.defense / 2);\r\n\r\n        // æ•æ·å½±å“å‘½ä¸­å’Œé—ªé¿\r\n        const agilityDiff = attacker.agility - defender.agility;\r\n\r\n        // å‘½ä¸­ç‡è°ƒæ•´ (åŠ æˆæˆ–å‡å°‘æœ€å¤š20%)\r\n        const hitRateAdjustment = Math.min(0.2, Math.max(-0.2, agilityDiff * 0.02));\r\n        const baseHitRate = 0.9; // åŸºç¡€90%å‘½ä¸­ç‡\r\n        const hitRate = Math.min(0.99, Math.max(0.7, baseHitRate + hitRateAdjustment));\r\n\r\n        // æ£€æŸ¥æ˜¯å¦å‘½ä¸­\r\n        if (Math.random() > hitRate) {\r\n            // é—ªé¿\r\n            return 0;\r\n        }\r\n\r\n        // éšæœºæ³¢åŠ¨ (Â±20%)\r\n        const randomFactor = 0.8 + Math.random() * 0.4;\r\n        return Math.floor(baseDamage * randomFactor);\r\n    };\r\n\r\n    // æ¸¸æˆä¸»å¾ªç¯\r\n    useEffect(() => {\r\n        // åªåœ¨æˆ˜æ–—åœºæ™¯ä¸”æ¸¸æˆæ­£åœ¨è¿è¡Œæ—¶æ‰§è¡Œæˆ˜æ–—å¾ªç¯\r\n        if (state.gameScene !== 'battle' || !state.gameRunning || !state.monster) return;\r\n\r\n        const gameLoop = setInterval(() => {\r\n            // æ£€æŸ¥ç©å®¶æ˜¯å¦æ­»äº¡\r\n            if (state.player.currentHealth <= 0) {\r\n                dispatch({\r\n                    type: 'ADD_LOG',\r\n                    payload: {\r\n                        text: `æˆ˜æ–—å¤±è´¥ï¼${state.player.name}è¢«${state.monster.name}å‡»è´¥äº†ï¼`,\r\n                        isCritical: true\r\n                    }\r\n                });\r\n\r\n                // å»¶è¿Ÿåè¿”å›é€‰æ‹©é¡µé¢\r\n                setTimeout(() => {\r\n                    dispatch({ type: 'RETURN_TO_SELECT' });\r\n                }, 2000);\r\n\r\n                return;\r\n            }\r\n\r\n            // æ£€æŸ¥æ€ªç‰©æ˜¯å¦æ­»äº¡\r\n            if (state.monster.currentHealth <= 0) {\r\n                dispatch({\r\n                    type: 'ADD_LOG',\r\n                    payload: {\r\n                        text: `æˆ˜æ–—èƒœåˆ©ï¼${state.player.name}å‡»è´¥äº†${state.monster.name}ï¼`,\r\n                        isCritical: true\r\n                    }\r\n                });\r\n\r\n                // è·å¾—ç»éªŒå€¼\r\n                dispatch({\r\n                    type: 'PLAYER_GAIN_EXPERIENCE',\r\n                    payload: { experience: state.monster.expReward }\r\n                });\r\n\r\n                // æ£€æŸ¥æ˜¯å¦æ‰è½è£…å¤‡\r\n                dispatch({ type: 'DROP_EQUIPMENT' });\r\n\r\n                // æ¢å¤ç©å®¶è¡€é‡\r\n                setTimeout(() => {\r\n                    dispatch({ type: 'RESET_PLAYER_HEALTH' });\r\n                }, 1000);\r\n\r\n                // ç”Ÿæˆæ–°æ€ªç‰©\r\n                setTimeout(() => {\r\n                    dispatch({ type: 'RESET_MONSTER' });\r\n                }, 2000);\r\n\r\n                return;\r\n            }\r\n\r\n            // ç©å®¶æ”»å‡»\r\n            dispatch({ type: 'PLAYER_ATTACK' });\r\n\r\n            setTimeout(() => {\r\n                dispatch({ type: 'PLAYER_ATTACK_END' });\r\n\r\n                const isCritical = Math.random() < state.player.critChance;\r\n                let damage = calculateDamage(state.player, state.monster);\r\n\r\n                if (damage === 0) {\r\n                    dispatch({\r\n                        type: 'ADD_LOG',\r\n                        payload: {\r\n                            text: `${state.monster.name}é—ªé¿äº†${state.player.name}çš„æ”»å‡»ï¼`,\r\n                            isCritical: false\r\n                        }\r\n                    });\r\n                } else {\r\n                    if (isCritical) {\r\n                        damage = Math.floor(damage * state.player.critMultiplier);\r\n                    }\r\n\r\n                    dispatch({\r\n                        type: 'MONSTER_DAMAGE',\r\n                        payload: { damage, isCritical }\r\n                    });\r\n                }\r\n\r\n                setTimeout(() => {\r\n                    dispatch({ type: 'MONSTER_DAMAGE_END' });\r\n\r\n                    // æ€ªç‰©æ”»å‡» (å¦‚æœè¿˜æ´»ç€)\r\n                    if (state.monster.currentHealth > 0) {\r\n                        setTimeout(() => {\r\n                            dispatch({ type: 'MONSTER_ATTACK' });\r\n\r\n                            setTimeout(() => {\r\n                                dispatch({ type: 'MONSTER_ATTACK_END' });\r\n\r\n                                const monsterCritical = Math.random() < state.monster.critChance;\r\n                                let monsterDamage = calculateDamage(state.monster, state.player);\r\n\r\n                                if (monsterDamage === 0) {\r\n                                    dispatch({\r\n                                        type: 'ADD_LOG',\r\n                                        payload: {\r\n                                            text: `${state.player.name}é—ªé¿äº†${state.monster.name}çš„æ”»å‡»ï¼`,\r\n                                            isCritical: false\r\n                                        }\r\n                                    });\r\n                                } else {\r\n                                    if (monsterCritical) {\r\n                                        monsterDamage = Math.floor(monsterDamage * state.monster.critMultiplier);\r\n                                    }\r\n\r\n                                    dispatch({\r\n                                        type: 'PLAYER_DAMAGE',\r\n                                        payload: { damage: monsterDamage, isCritical: monsterCritical }\r\n                                    });\r\n                                }\r\n\r\n                                setTimeout(() => {\r\n                                    dispatch({ type: 'PLAYER_DAMAGE_END' });\r\n                                }, 500);\r\n                            }, 500);\r\n                        }, 500);\r\n                    }\r\n                }, 500);\r\n            }, 500);\r\n\r\n        }, state.gameSpeed);\r\n\r\n        return () => clearInterval(gameLoop);\r\n    }, [state.gameScene, state.gameRunning, state.player, state.monster, state.selectedBattlefield]);\r\n\r\n    const value = {\r\n        state,\r\n        dispatch,\r\n        calculateExpToNextLevel,\r\n        equipmentTypes,\r\n        rarities\r\n    };\r\n\r\n    return (\r\n        <GameContext.Provider value={value}>\r\n            {children}\r\n        </GameContext.Provider>\r\n    );\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}