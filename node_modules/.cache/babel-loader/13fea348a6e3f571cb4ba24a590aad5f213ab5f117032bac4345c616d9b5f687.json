{"ast":null,"code":"var _jsxFileName = \"D:\\\\mm-rpg-react\\\\src\\\\contexts\\\\GameContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { createContext, useContext, useReducer, useEffect } from 'react';\n\n// æˆ˜åœºé…ç½®\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst battlefields = [{\n  id: 'novice',\n  name: 'æ–°æ‰‹æ‘',\n  levelRange: [1, 10],\n  background: '#e6f7ff',\n  description: 'é€‚åˆ1-10çº§ç©å®¶çš„æ–°æ‰‹æˆ˜åœº'\n}, {\n  id: 'intermediate',\n  name: 'è¿›é˜¶æ£®æ—',\n  levelRange: [11, 20],\n  background: '#e6ffe6',\n  description: 'é€‚åˆ11-20çº§ç©å®¶çš„è¿›é˜¶æˆ˜åœº'\n}, {\n  id: 'hell',\n  name: 'åœ°ç‹±çº§éš¾åº¦',\n  levelRange: [21, 30],\n  background: '#ffe6e6',\n  description: 'é€‚åˆ21-30çº§ç©å®¶çš„é«˜éš¾åº¦æˆ˜åœº'\n}];\n\n// è£…å¤‡ç±»å‹å®šä¹‰\nconst equipmentTypes = {\n  HEAD: {\n    id: 'HEAD',\n    name: 'å¤´éƒ¨',\n    emoji: 'ğŸ§¢',\n    slot: 'head'\n  },\n  BODY: {\n    id: 'BODY',\n    name: 'èº«ä½“',\n    emoji: 'ğŸ‘•',\n    slot: 'body'\n  },\n  BELT: {\n    id: 'BELT',\n    name: 'è…°å¸¦',\n    emoji: 'ğŸ§¶',\n    slot: 'belt'\n  },\n  SHOES: {\n    id: 'SHOES',\n    name: 'é‹å­',\n    emoji: 'ğŸ‘',\n    slot: 'shoes'\n  },\n  WEAPON: {\n    id: 'WEAPON',\n    name: 'æ­¦å™¨',\n    emoji: 'ğŸ—¡ï¸',\n    slot: 'weapon'\n  },\n  NECKLACE: {\n    id: 'NECKLACE',\n    name: 'é¡¹é“¾',\n    emoji: 'ğŸ“¿',\n    slot: 'necklace'\n  },\n  ACCESSORY: {\n    id: 'ACCESSORY',\n    name: 'é¦–é¥°',\n    emoji: 'ğŸ’',\n    slot: 'accessory'\n  }\n};\n\n// è£…å¤‡ç¨€æœ‰åº¦å®šä¹‰\nconst rarities = {\n  COMMON: {\n    id: 'COMMON',\n    name: 'æ™®é€š',\n    color: '#a0a0a0',\n    chance: 0.6,\n    multiplier: 1\n  },\n  UNCOMMON: {\n    id: 'UNCOMMON',\n    name: 'ä¼˜ç§€',\n    color: '#1eff00',\n    chance: 0.3,\n    multiplier: 1.5\n  },\n  RARE: {\n    id: 'RARE',\n    name: 'ç²¾è‰¯',\n    color: '#0070dd',\n    chance: 0.08,\n    multiplier: 2\n  },\n  EPIC: {\n    id: 'EPIC',\n    name: 'å²è¯—',\n    color: '#a335ee',\n    chance: 0.02,\n    multiplier: 2.5\n  },\n  LEGENDARY: {\n    id: 'LEGENDARY',\n    name: 'ä¼ è¯´',\n    color: '#ff8000',\n    chance: 0.004,\n    multiplier: 3\n  }\n};\n\n// è£…å¤‡å±æ€§å®šä¹‰\nconst attributeTypes = {\n  HEALTH: {\n    id: 'HEALTH',\n    name: 'ç”Ÿå‘½å€¼',\n    min: 5,\n    max: 20,\n    scaling: 2\n  },\n  ATTACK: {\n    id: 'ATTACK',\n    name: 'æ”»å‡»åŠ›',\n    min: 1,\n    max: 5,\n    scaling: 0.5\n  },\n  DEFENSE: {\n    id: 'DEFENSE',\n    name: 'é˜²å¾¡åŠ›',\n    min: 1,\n    max: 3,\n    scaling: 0.3\n  },\n  AGILITY: {\n    id: 'AGILITY',\n    name: 'æ•æ·åº¦',\n    min: 1,\n    max: 3,\n    scaling: 0.3\n  },\n  CRIT_CHANCE: {\n    id: 'CRIT_CHANCE',\n    name: 'æš´å‡»ç‡',\n    min: 0.01,\n    max: 0.03,\n    scaling: 0.003\n  }\n};\n\n// æŒ‰è£…å¤‡ç±»å‹åˆ’åˆ†å¯èƒ½çš„å±æ€§ (æŸäº›å±æ€§åªåœ¨ç‰¹å®šè£…å¤‡ä¸Šå‡ºç°)\nconst equipmentAttributes = {\n  HEAD: ['HEALTH', 'DEFENSE'],\n  BODY: ['HEALTH', 'DEFENSE'],\n  BELT: ['HEALTH', 'AGILITY'],\n  SHOES: ['AGILITY', 'DEFENSE'],\n  WEAPON: ['ATTACK', 'CRIT_CHANCE'],\n  NECKLACE: ['HEALTH', 'CRIT_CHANCE'],\n  ACCESSORY: ['ATTACK', 'AGILITY', 'CRIT_CHANCE']\n};\n\n// éšæœºç”Ÿæˆè£…å¤‡\nconst generateEquipment = (playerLevel, dropRateBonus = 0) => {\n  // è£…å¤‡ç­‰çº§èŒƒå›´\n  const equipLevel = Math.max(1, Math.floor(playerLevel * (0.8 + Math.random() * 0.4)));\n\n  // éšæœºè£…å¤‡ç±»å‹\n  const equipTypeKeys = Object.keys(equipmentTypes);\n  const randomType = equipmentTypes[equipTypeKeys[Math.floor(Math.random() * equipTypeKeys.length)]];\n\n  // éšæœºç¨€æœ‰åº¦ (ä½¿ç”¨æ¦‚ç‡æƒé‡)\n  let rarityRoll = Math.random() - dropRateBonus; // æ‰è½ç‡åŠ æˆæé«˜ç¨€æœ‰åº¦æ¦‚ç‡\n  rarityRoll = Math.max(0, rarityRoll); // ç¡®ä¿ä¸ä¼šæ˜¯è´Ÿæ•°\n\n  let selectedRarity;\n  if (rarityRoll < rarities.LEGENDARY.chance) {\n    selectedRarity = rarities.LEGENDARY;\n  } else if (rarityRoll < rarities.EPIC.chance + rarities.LEGENDARY.chance) {\n    selectedRarity = rarities.EPIC;\n  } else if (rarityRoll < rarities.RARE.chance + rarities.EPIC.chance + rarities.LEGENDARY.chance) {\n    selectedRarity = rarities.RARE;\n  } else if (rarityRoll < rarities.UNCOMMON.chance + rarities.RARE.chance + rarities.EPIC.chance + rarities.LEGENDARY.chance) {\n    selectedRarity = rarities.UNCOMMON;\n  } else {\n    selectedRarity = rarities.COMMON;\n  }\n\n  // ç¡®å®šå±æ€§æ•°é‡ (åŸºäºç¨€æœ‰åº¦)\n  const attrCount = Math.floor(Math.random() * 2) + 1; // 1-2ä¸ªå±æ€§\n\n  // éšæœºé€‰æ‹©å±æ€§\n  const possibleAttributes = equipmentAttributes[randomType.id];\n  const shuffledAttributes = [...possibleAttributes].sort(() => 0.5 - Math.random());\n  const selectedAttributes = shuffledAttributes.slice(0, attrCount);\n\n  // ä¸ºæ¯ä¸ªå±æ€§éšæœºç”Ÿæˆæ•°å€¼\n  const attributes = {};\n  selectedAttributes.forEach(attrKey => {\n    const attr = attributeTypes[attrKey];\n    // åŸºç¡€å±æ€§å€¼ + ç­‰çº§ç¼©æ”¾ * ç¨€æœ‰åº¦å€ç‡\n    const baseValue = attr.min + Math.random() * (attr.max - attr.min);\n    const levelScaling = attr.scaling * equipLevel;\n    let value = (baseValue + levelScaling) * selectedRarity.multiplier;\n\n    // å¯¹æš´å‡»ç‡è¿›è¡Œç‰¹æ®Šå¤„ç†ï¼Œç¡®ä¿ä¸è¶…è¿‡åˆç†èŒƒå›´\n    if (attrKey === 'CRIT_CHANCE') {\n      value = Math.min(value, 0.25); // æœ€é«˜25%æš´å‡»ç‡\n      value = Math.round(value * 1000) / 1000; // ä¿ç•™3ä½å°æ•°\n    } else {\n      value = Math.floor(value); // å…¶ä»–å±æ€§å–æ•´\n    }\n    attributes[attrKey] = value;\n  });\n\n  // ç”Ÿæˆè£…å¤‡åç§°\n  const prefixes = ['é”‹åˆ©çš„', 'åšå›ºçš„', 'é—ªäº®çš„', 'ç ´æ—§çš„', 'ç¥ç§˜çš„', 'å¤è€çš„', 'å¼ºåŒ–çš„', 'ç²¾åˆ¶çš„', 'é­”æ³•çš„', 'ä¼ æ‰¿çš„'];\n  const randomPrefix = prefixes[Math.floor(Math.random() * prefixes.length)];\n  const name = `${randomPrefix} ${randomType.name}`;\n\n  // ç”Ÿæˆå”¯ä¸€ID\n  const id = `equip_${Date.now()}_${Math.floor(Math.random() * 1000)}`;\n  return {\n    id,\n    name,\n    type: randomType.id,\n    emoji: randomType.emoji,\n    slot: randomType.slot,\n    level: equipLevel,\n    rarity: selectedRarity.id,\n    rarityName: selectedRarity.name,\n    rarityColor: selectedRarity.color,\n    attributes\n  };\n};\n\n// æ€ªç‰©é…ç½®ï¼ˆæ ¹æ®ç­‰çº§ç”Ÿæˆï¼‰\nconst generateMonster = (playerLevel, battlefieldId) => {\n  // æ ¹æ®æˆ˜åœºç¡®å®šæ€ªç‰©ç­‰çº§èŒƒå›´\n  let minLevel = playerLevel - 2;\n  let maxLevel = playerLevel + 2;\n  const battlefield = battlefields.find(bf => bf.id === battlefieldId);\n\n  // ç¡®ä¿æ€ªç‰©ç­‰çº§åœ¨æˆ˜åœºèŒƒå›´å†…\n  if (battlefield) {\n    minLevel = Math.max(minLevel, battlefield.levelRange[0]);\n    maxLevel = Math.min(maxLevel, battlefield.levelRange[1]);\n  }\n\n  // éšæœºç¡®å®šæ€ªç‰©ç­‰çº§\n  const monsterLevel = Math.floor(Math.random() * (maxLevel - minLevel + 1)) + minLevel;\n\n  // æ€ªç‰©ç±»å‹\n  const monsterTypes = [{\n    name: 'å²è±å§†',\n    emoji: 'ğŸŸ¢',\n    baseHealth: 50,\n    baseAttack: 5,\n    baseDefense: 2,\n    baseAgility: 1\n  }, {\n    name: 'è™è ',\n    emoji: 'ğŸ¦‡',\n    baseHealth: 40,\n    baseAttack: 7,\n    baseDefense: 1,\n    baseAgility: 5\n  }, {\n    name: 'éª·é«…',\n    emoji: 'ğŸ’€',\n    baseHealth: 60,\n    baseAttack: 6,\n    baseDefense: 3,\n    baseAgility: 2\n  }, {\n    name: 'èœ˜è››',\n    emoji: 'ğŸ•·ï¸',\n    baseHealth: 45,\n    baseAttack: 6,\n    baseDefense: 2,\n    baseAgility: 4\n  }, {\n    name: 'å¹½çµ',\n    emoji: 'ğŸ‘»',\n    baseHealth: 55,\n    baseAttack: 8,\n    baseDefense: 0,\n    baseAgility: 6\n  }, {\n    name: 'å·¨é­”',\n    emoji: 'ğŸ‘¹',\n    baseHealth: 70,\n    baseAttack: 9,\n    baseDefense: 4,\n    baseAgility: 1\n  }, {\n    name: 'æ¶é­”',\n    emoji: 'ğŸ˜ˆ',\n    baseHealth: 65,\n    baseAttack: 10,\n    baseDefense: 3,\n    baseAgility: 3\n  }];\n\n  // æ ¹æ®æˆ˜åœºéš¾åº¦é€‰æ‹©æ€ªç‰©\n  let availableMonsters;\n  if (battlefieldId === 'novice') {\n    availableMonsters = monsterTypes.slice(0, 3); // ç®€å•æ€ªç‰©\n  } else if (battlefieldId === 'intermediate') {\n    availableMonsters = monsterTypes.slice(2, 5); // ä¸­ç­‰æ€ªç‰©\n  } else {\n    availableMonsters = monsterTypes.slice(4); // å›°éš¾æ€ªç‰©\n  }\n\n  // éšæœºé€‰æ‹©ä¸€ç§æ€ªç‰©\n  const monsterType = availableMonsters[Math.floor(Math.random() * availableMonsters.length)];\n\n  // åŸºäºç­‰çº§è®¡ç®—æ€ªç‰©å±æ€§\n  const levelMultiplier = 1 + (monsterLevel - 1) * 0.1; // æ¯çº§æå‡10%\n\n  return {\n    name: `${monsterLevel}çº§${monsterType.name}`,\n    emoji: monsterType.emoji,\n    level: monsterLevel,\n    maxHealth: Math.floor(monsterType.baseHealth * levelMultiplier),\n    currentHealth: Math.floor(monsterType.baseHealth * levelMultiplier),\n    attack: Math.floor(monsterType.baseAttack * levelMultiplier),\n    defense: Math.floor(monsterType.baseDefense * levelMultiplier),\n    agility: Math.floor(monsterType.baseAgility * levelMultiplier),\n    critChance: 0.1 + monsterLevel * 0.005,\n    // åŸºç¡€10%ï¼Œæ¯çº§+0.5%\n    critMultiplier: 1.5,\n    // æ€ªç‰©ç»éªŒå€¼ï¼šåŸºç¡€å€¼ + ç­‰çº§åŠ æˆ\n    expReward: 10 + monsterLevel * 5,\n    // æ‰è½è£…å¤‡æ¦‚ç‡ (20% + ç­‰çº§åŠ æˆ)\n    dropChance: 0.2 + monsterLevel * 0.01\n  };\n};\n\n// è®¡ç®—å‡çº§æ‰€éœ€ç»éªŒ\nconst calculateExpToNextLevel = level => {\n  // ä½¿ç”¨æŒ‡æ•°å¢é•¿å…¬å¼: 100 * (level)^1.5\n  return Math.floor(100 * Math.pow(level, 1.5));\n};\n\n// è®¡ç®—è£…å¤‡æä¾›çš„å±æ€§æ€»å’Œ\nconst calculateEquipmentStats = equipment => {\n  const stats = {\n    health: 0,\n    attack: 0,\n    defense: 0,\n    agility: 0,\n    critChance: 0\n  };\n\n  // éå†æ‰€æœ‰è£…å¤‡æ§½ä½\n  Object.values(equipment).forEach(equip => {\n    if (!equip) return; // å¦‚æœæ§½ä½æ²¡æœ‰è£…å¤‡\n\n    // ç´¯åŠ è£…å¤‡å±æ€§\n    Object.entries(equip.attributes).forEach(([key, value]) => {\n      switch (key) {\n        case 'HEALTH':\n          stats.health += value;\n          break;\n        case 'ATTACK':\n          stats.attack += value;\n          break;\n        case 'DEFENSE':\n          stats.defense += value;\n          break;\n        case 'AGILITY':\n          stats.agility += value;\n          break;\n        case 'CRIT_CHANCE':\n          stats.critChance += value;\n          break;\n        default:\n          break;\n      }\n    });\n  });\n  return stats;\n};\n\n// åˆå§‹çŠ¶æ€\n// åˆå§‹çŠ¶æ€\nconst createInitialState = () => {\n  try {\n    // å°è¯•ä»localStorageè¯»å–ä¿å­˜çš„çŠ¶æ€\n    const savedState = localStorage.getItem('rpgGameState');\n    if (savedState) {\n      const parsedState = JSON.parse(savedState);\n\n      // æ£€æŸ¥å¹¶ç¡®ä¿æ‰€æœ‰å…³é”®å±æ€§éƒ½å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™ä½¿ç”¨é»˜è®¤å€¼\n      // ç¡®ä¿inventoryå­˜åœ¨\n      if (!parsedState.inventory) {\n        parsedState.inventory = {\n          maxSlots: 20,\n          items: []\n        };\n      }\n\n      // ç¡®ä¿modalå­˜åœ¨\n      if (!parsedState.modal) {\n        parsedState.modal = {\n          isOpen: false,\n          type: null,\n          data: null\n        };\n      }\n\n      // ç¡®ä¿equipmentå­˜åœ¨\n      if (!parsedState.equipment) {\n        parsedState.equipment = {\n          head: null,\n          body: null,\n          belt: null,\n          shoes: null,\n          weapon: null,\n          necklace: null,\n          accessory: null\n        };\n      }\n      return parsedState;\n    }\n  } catch (e) {\n    console.error('Failed to parse saved game state:', e);\n  }\n\n  // é»˜è®¤åˆå§‹çŠ¶æ€\n  return {\n    // æ¸¸æˆåœºæ™¯çŠ¶æ€: 'select' - æˆ˜åœºé€‰æ‹©é¡µé¢, 'battle' - æˆ˜æ–—é¡µé¢\n    gameScene: 'select',\n    selectedBattlefield: null,\n    // è§’è‰²åŸºç¡€å±æ€§\n    player: {\n      name: \"å‹‡è€…\",\n      level: 1,\n      experience: 0,\n      expToNextLevel: calculateExpToNextLevel(1),\n      maxHealth: 100,\n      currentHealth: 100,\n      attack: 10,\n      defense: 5,\n      agility: 3,\n      // æ–°å¢æ•æ·åº¦å±æ€§\n      critChance: 0.1,\n      critMultiplier: 1.5\n    },\n    // è£…å¤‡ç³»ç»Ÿ\n    equipment: {\n      head: null,\n      body: null,\n      belt: null,\n      shoes: null,\n      weapon: null,\n      necklace: null,\n      accessory: null\n    },\n    // ç‰©å“æ \n    inventory: {\n      maxSlots: 20,\n      // ç‰©å“æ æœ€å¤§æ ¼å­æ•°\n      items: [] // ç‰©å“åˆ—è¡¨ï¼Œæ¯ä¸ªç‰©å“åŒ…å« {id, count, ...itemData}\n    },\n    // æ¨¡æ€çª—å£çŠ¶æ€\n    modal: {\n      isOpen: false,\n      type: null,\n      // 'character', 'equipment', 'inventory'\n      data: null\n    },\n    // ç‰©å“å³é”®èœå•çŠ¶æ€\n    contextMenu: {\n      isOpen: false,\n      position: {\n        x: 0,\n        y: 0\n      },\n      item: null\n    },\n    monster: null,\n    battleLogs: [],\n    playerAttacking: false,\n    monsterAttacking: false,\n    playerDamaged: false,\n    monsterDamaged: false,\n    gameSpeed: 2000,\n    // æ¯å›åˆé—´éš”(æ¯«ç§’)\n    gameRunning: true,\n    battlefields: battlefields\n  };\n};\n\n// Reducerå‡½æ•°æ¥å¤„ç†çŠ¶æ€æ›´æ–°\nfunction gameReducer(state, action) {\n  let newState;\n  switch (action.type) {\n    // é€‰æ‹©æˆ˜åœº\n    case 'SELECT_BATTLEFIELD':\n      newState = {\n        ...state,\n        gameScene: 'battle',\n        selectedBattlefield: action.payload,\n        battleLogs: [{\n          id: Date.now(),\n          text: `è¿›å…¥${action.payload.name}æˆ˜åœºï¼`,\n          isCritical: false\n        }],\n        // ç”Ÿæˆæ–°æ€ªç‰©\n        monster: generateMonster(state.player.level, action.payload.id)\n      };\n      break;\n\n    // è¿”å›é€‰æ‹©é¡µé¢\n    case 'RETURN_TO_SELECT':\n      newState = {\n        ...state,\n        gameScene: 'select',\n        monster: null,\n        battleLogs: []\n      };\n      break;\n\n    // æ‰“å¼€æ¨¡æ€çª—å£\n    case 'OPEN_MODAL':\n      newState = {\n        ...state,\n        modal: {\n          isOpen: true,\n          type: action.payload.type,\n          data: action.payload.data || null\n        }\n      };\n      break;\n\n    // å…³é—­æ¨¡æ€çª—å£\n    case 'CLOSE_MODAL':\n      newState = {\n        ...state,\n        modal: {\n          ...state.modal,\n          isOpen: false\n        }\n      };\n      break;\n\n    // æ‰“å¼€å³é”®èœå•\n    case 'OPEN_CONTEXT_MENU':\n      newState = {\n        ...state,\n        contextMenu: {\n          isOpen: true,\n          position: action.payload.position,\n          item: action.payload.item\n        }\n      };\n      break;\n\n    // å…³é—­å³é”®èœå•\n    case 'CLOSE_CONTEXT_MENU':\n      newState = {\n        ...state,\n        contextMenu: {\n          ...state.contextMenu,\n          isOpen: false\n        }\n      };\n      break;\n\n    // è£…å¤‡ç‰©å“\n    case 'EQUIP_ITEM':\n      {\n        const item = action.payload;\n        const {\n          slot\n        } = item;\n\n        // æ£€æŸ¥æ˜¯å¦å·²ç»æœ‰è£…å¤‡åœ¨è¯¥æ§½ä½\n        const existingEquipment = state.equipment[slot];\n        let newInventory = {\n          ...state.inventory\n        };\n\n        // ä»ç‰©å“æ ç§»é™¤è¦è£…å¤‡çš„ç‰©å“\n        newInventory.items = newInventory.items.filter(invItem => {\n          if (invItem.id === item.id) {\n            if (invItem.count > 1) {\n              invItem.count--;\n              return true;\n            }\n            return false;\n          }\n          return true;\n        });\n\n        // å¦‚æœæ§½ä½å·²æœ‰è£…å¤‡ï¼Œå°†å…¶æ”¾å›ç‰©å“æ \n        if (existingEquipment) {\n          // æ£€æŸ¥ç‰©å“æ æ˜¯å¦å·²æœ‰ç›¸åŒç‰©å“\n          const existingInvItem = newInventory.items.find(i => i.id === existingEquipment.id || i.name === existingEquipment.name && i.level === existingEquipment.level);\n          if (existingInvItem) {\n            existingInvItem.count++;\n          } else {\n            // æ£€æŸ¥ç‰©å“æ æ˜¯å¦å·²æ»¡\n            if (newInventory.items.length < newInventory.maxSlots) {\n              newInventory.items.push({\n                ...existingEquipment,\n                count: 1\n              });\n            } else {\n              // å¦‚æœæ»¡äº†ï¼Œæ·»åŠ æç¤º\n              newState = {\n                ...state,\n                battleLogs: [{\n                  id: Date.now(),\n                  text: `ç‰©å“æ å·²æ»¡ï¼Œæ— æ³•å¸ä¸‹${existingEquipment.name}ï¼`,\n                  isCritical: true\n                }, ...state.battleLogs.slice(0, 19)]\n              };\n              break;\n            }\n          }\n        }\n\n        // åˆ›å»ºæ–°çš„è£…å¤‡çŠ¶æ€\n        const newEquipment = {\n          ...state.equipment,\n          [slot]: {\n            ...item,\n            count: 1\n          }\n        };\n\n        // è·å–æ–°çš„è£…å¤‡åŠ æˆ\n        const equipStats = calculateEquipmentStats(newEquipment);\n\n        // æ›´æ–°ç©å®¶å±æ€§ï¼ˆåŸºç¡€å±æ€§+è£…å¤‡åŠ æˆï¼‰\n        const basePlayer = {\n          ...state.player\n        };\n        const updatedPlayer = {\n          ...basePlayer,\n          maxHealth: basePlayer.maxHealth + equipStats.health,\n          currentHealth: Math.min(basePlayer.currentHealth + equipStats.health, basePlayer.maxHealth + equipStats.health),\n          attack: basePlayer.attack + equipStats.attack,\n          defense: basePlayer.defense + equipStats.defense,\n          agility: basePlayer.agility + equipStats.agility,\n          critChance: basePlayer.critChance + equipStats.critChance\n        };\n        newState = {\n          ...state,\n          equipment: newEquipment,\n          inventory: newInventory,\n          player: updatedPlayer,\n          battleLogs: [{\n            id: Date.now(),\n            text: `è£…å¤‡äº†${item.name}ï¼`,\n            isCritical: false\n          }, ...state.battleLogs.slice(0, 19)]\n        };\n      }\n      break;\n\n    // å¸ä¸‹è£…å¤‡\n    case 'UNEQUIP_ITEM':\n      {\n        const slot = action.payload;\n        const item = state.equipment[slot];\n        if (!item) {\n          newState = state;\n          break;\n        }\n\n        // æ£€æŸ¥ç‰©å“æ æ˜¯å¦å·²æ»¡\n        if (state.inventory.items.length >= state.inventory.maxSlots) {\n          newState = {\n            ...state,\n            battleLogs: [{\n              id: Date.now(),\n              text: `ç‰©å“æ å·²æ»¡ï¼Œæ— æ³•å¸ä¸‹${item.name}ï¼`,\n              isCritical: true\n            }, ...state.battleLogs.slice(0, 19)]\n          };\n          break;\n        }\n\n        // æ£€æŸ¥ç‰©å“æ æ˜¯å¦å·²æœ‰ç›¸åŒç‰©å“\n        let newInventory = {\n          ...state.inventory\n        };\n        const existingItem = newInventory.items.find(i => i.id === item.id || i.name === item.name && i.level === item.level);\n        if (existingItem) {\n          existingItem.count++;\n        } else {\n          newInventory.items.push({\n            ...item,\n            count: 1\n          });\n        }\n\n        // åˆ›å»ºæ–°çš„è£…å¤‡çŠ¶æ€\n        const newEquipment = {\n          ...state.equipment,\n          [slot]: null\n        };\n\n        // è·å–æ–°çš„è£…å¤‡åŠ æˆ\n        const equipStats = calculateEquipmentStats(newEquipment);\n\n        // æ›´æ–°ç©å®¶å±æ€§ï¼ˆåŸºç¡€å±æ€§+è£…å¤‡åŠ æˆï¼‰\n        const basePlayer = {\n          ...state.player\n        };\n        const updatedPlayer = {\n          ...basePlayer,\n          maxHealth: basePlayer.maxHealth - equipStats.health,\n          currentHealth: Math.min(basePlayer.currentHealth, basePlayer.maxHealth - equipStats.health),\n          attack: basePlayer.attack - equipStats.attack,\n          defense: basePlayer.defense - equipStats.defense,\n          agility: basePlayer.agility - equipStats.agility,\n          critChance: basePlayer.critChance - equipStats.critChance\n        };\n        newState = {\n          ...state,\n          equipment: newEquipment,\n          inventory: newInventory,\n          player: updatedPlayer,\n          battleLogs: [{\n            id: Date.now(),\n            text: `å¸ä¸‹äº†${item.name}ï¼`,\n            isCritical: false\n          }, ...state.battleLogs.slice(0, 19)]\n        };\n      }\n      break;\n\n    // ä¸¢å¼ƒç‰©å“\n    case 'DISCARD_ITEM':\n      {\n        const item = action.payload;\n\n        // ä»ç‰©å“æ ç§»é™¤ç‰©å“\n        const newInventory = {\n          ...state.inventory\n        };\n        newInventory.items = newInventory.items.filter(invItem => invItem.id !== item.id);\n        newState = {\n          ...state,\n          inventory: newInventory,\n          battleLogs: [{\n            id: Date.now(),\n            text: `ä¸¢å¼ƒäº†${item.name} x${item.count}ï¼`,\n            isCritical: false\n          }, ...state.battleLogs.slice(0, 19)]\n        };\n      }\n      break;\n\n    // è·å¾—ç‰©å“\n    case 'GAIN_ITEM':\n      {\n        const item = action.payload;\n\n        // æ£€æŸ¥ç‰©å“æ æ˜¯å¦å·²æ»¡\n        if (state.inventory.items.length >= state.inventory.maxSlots) {\n          // ç‰©å“æ å·²æ»¡ï¼Œæ— æ³•è·å¾—ç‰©å“\n          newState = {\n            ...state,\n            battleLogs: [{\n              id: Date.now(),\n              text: `ç‰©å“æ å·²æ»¡ï¼Œæ— æ³•è·å¾—${item.name}ï¼`,\n              isCritical: true\n            }, ...state.battleLogs.slice(0, 19)]\n          };\n          break;\n        }\n\n        // æ£€æŸ¥ç‰©å“æ æ˜¯å¦å·²æœ‰ç›¸åŒç‰©å“\n        const newInventory = {\n          ...state.inventory\n        };\n        const existingItem = newInventory.items.find(i => i.id === item.id || i.name === item.name && i.level === item.level && i.rarity === item.rarity);\n        if (existingItem) {\n          // å¦‚æœå·²æœ‰ç›¸åŒç‰©å“ï¼Œå¢åŠ æ•°é‡\n          existingItem.count++;\n        } else {\n          // å¦åˆ™æ·»åŠ æ–°ç‰©å“\n          newInventory.items.push({\n            ...item,\n            count: 1\n          });\n        }\n        newState = {\n          ...state,\n          inventory: newInventory,\n          battleLogs: [{\n            id: Date.now(),\n            text: `è·å¾—äº†${item.name}ï¼`,\n            isCritical: false\n          }, ...state.battleLogs.slice(0, 19)]\n        };\n      }\n      break;\n\n    // ç©å®¶æ”»å‡»\n    case 'PLAYER_ATTACK':\n      newState = {\n        ...state,\n        playerAttacking: true\n      };\n      break;\n\n    // ç©å®¶æ”»å‡»ç»“æŸ\n    case 'PLAYER_ATTACK_END':\n      newState = {\n        ...state,\n        playerAttacking: false\n      };\n      break;\n\n    // æ€ªç‰©å—ä¼¤\n    case 'MONSTER_DAMAGE':\n      newState = {\n        ...state,\n        monsterDamaged: true,\n        monster: {\n          ...state.monster,\n          currentHealth: Math.max(0, state.monster.currentHealth - action.payload.damage)\n        },\n        battleLogs: [{\n          id: Date.now(),\n          text: action.payload.isCritical ? `æš´å‡»ï¼${state.player.name}å¯¹${state.monster.name}é€ æˆäº†${action.payload.damage}ç‚¹ä¼¤å®³ï¼` : `${state.player.name}å¯¹${state.monster.name}é€ æˆäº†${action.payload.damage}ç‚¹ä¼¤å®³ã€‚`,\n          isCritical: action.payload.isCritical\n        }, ...state.battleLogs.slice(0, 19)]\n      };\n      break;\n\n    // æ€ªç‰©å—ä¼¤ç»“æŸ\n    case 'MONSTER_DAMAGE_END':\n      newState = {\n        ...state,\n        monsterDamaged: false\n      };\n      break;\n\n    // æ€ªç‰©æ”»å‡»\n    case 'MONSTER_ATTACK':\n      newState = {\n        ...state,\n        monsterAttacking: true\n      };\n      break;\n\n    // æ€ªç‰©æ”»å‡»ç»“æŸ\n    case 'MONSTER_ATTACK_END':\n      newState = {\n        ...state,\n        monsterAttacking: false\n      };\n      break;\n\n    // ç©å®¶å—ä¼¤\n    case 'PLAYER_DAMAGE':\n      newState = {\n        ...state,\n        playerDamaged: true,\n        player: {\n          ...state.player,\n          currentHealth: Math.max(0, state.player.currentHealth - action.payload.damage)\n        },\n        battleLogs: [{\n          id: Date.now(),\n          text: action.payload.isCritical ? `æš´å‡»ï¼${state.monster.name}å¯¹${state.player.name}é€ æˆäº†${action.payload.damage}ç‚¹ä¼¤å®³ï¼` : `${state.monster.name}å¯¹${state.player.name}é€ æˆäº†${action.payload.damage}ç‚¹ä¼¤å®³ã€‚`,\n          isCritical: action.payload.isCritical\n        }, ...state.battleLogs.slice(0, 19)]\n      };\n      break;\n\n    // ç©å®¶å—ä¼¤ç»“æŸ\n    case 'PLAYER_DAMAGE_END':\n      newState = {\n        ...state,\n        playerDamaged: false\n      };\n      break;\n\n    // æ·»åŠ æ—¥å¿—\n    case 'ADD_LOG':\n      newState = {\n        ...state,\n        battleLogs: [{\n          id: Date.now(),\n          text: action.payload.text,\n          isCritical: action.payload.isCritical\n        }, ...state.battleLogs.slice(0, 19)]\n      };\n      break;\n\n    // ç©å®¶è·å¾—ç»éªŒ\n    case 'PLAYER_GAIN_EXPERIENCE':\n      {\n        const expGained = action.payload.experience;\n        let updatedPlayer = {\n          ...state.player\n        };\n        updatedPlayer.experience += expGained;\n\n        // æ£€æŸ¥æ˜¯å¦å‡çº§\n        let leveledUp = false;\n        while (updatedPlayer.experience >= updatedPlayer.expToNextLevel) {\n          // å‡çº§\n          updatedPlayer.level += 1;\n          updatedPlayer.experience -= updatedPlayer.expToNextLevel;\n          updatedPlayer.expToNextLevel = calculateExpToNextLevel(updatedPlayer.level);\n\n          // å±æ€§æå‡\n          const healthIncrease = Math.floor(20 + updatedPlayer.level * 5);\n          updatedPlayer.maxHealth += healthIncrease;\n          updatedPlayer.currentHealth += healthIncrease;\n          updatedPlayer.attack += 2;\n          updatedPlayer.defense += 1;\n          updatedPlayer.agility += 1;\n\n          // æ¯10çº§å¢åŠ æš´å‡»ç‡\n          if (updatedPlayer.level % 10 === 0) {\n            updatedPlayer.critChance += 0.05;\n          }\n          leveledUp = true;\n        }\n        const newLogs = leveledUp ? [{\n          id: Date.now(),\n          text: `è·å¾—${expGained}ç‚¹ç»éªŒï¼å‡çº§åˆ°${updatedPlayer.level}çº§ï¼`,\n          isCritical: true\n        }, ...state.battleLogs] : [{\n          id: Date.now(),\n          text: `è·å¾—${expGained}ç‚¹ç»éªŒï¼`,\n          isCritical: false\n        }, ...state.battleLogs];\n        newState = {\n          ...state,\n          player: updatedPlayer,\n          battleLogs: newLogs.slice(0, 20)\n        };\n      }\n      break;\n\n    // æ‰è½è£…å¤‡\n    case 'DROP_EQUIPMENT':\n      {\n        // æ£€æŸ¥æ˜¯å¦æ‰è½è£…å¤‡\n        const monster = state.monster;\n        const randomRoll = Math.random();\n        if (randomRoll <= monster.dropChance) {\n          // ç”Ÿæˆè£…å¤‡\n          const equipment = generateEquipment(monster.level);\n\n          // æ£€æŸ¥ç‰©å“æ æ˜¯å¦å·²æ»¡\n          if (state.inventory.items.length >= state.inventory.maxSlots) {\n            // ç‰©å“æ å·²æ»¡ï¼Œæ— æ³•è·å¾—è£…å¤‡\n            newState = {\n              ...state,\n              battleLogs: [{\n                id: Date.now(),\n                text: `æ€ªç‰©æ‰è½äº†${equipment.rarityName}å“è´¨çš„${equipment.name}ï¼Œä½†ç‰©å“æ å·²æ»¡ï¼Œæ— æ³•æ‹¾å–ï¼`,\n                isCritical: true\n              }, ...state.battleLogs.slice(0, 19)]\n            };\n            break;\n          }\n\n          // æ·»åŠ è£…å¤‡åˆ°ç‰©å“æ \n          const newInventory = {\n            ...state.inventory\n          };\n          newInventory.items.push({\n            ...equipment,\n            count: 1\n          });\n          newState = {\n            ...state,\n            inventory: newInventory,\n            battleLogs: [{\n              id: Date.now(),\n              text: `æ€ªç‰©æ‰è½äº†${equipment.rarityName}å“è´¨çš„${equipment.name}ï¼`,\n              isCritical: true\n            }, ...state.battleLogs.slice(0, 19)]\n          };\n        } else {\n          // æ²¡æœ‰æ‰è½è£…å¤‡\n          newState = state;\n        }\n      }\n      break;\n\n    // é‡ç½®æ€ªç‰©\n    case 'RESET_MONSTER':\n      newState = {\n        ...state,\n        monster: generateMonster(state.player.level, state.selectedBattlefield.id),\n        battleLogs: [{\n          id: Date.now(),\n          text: \"æ–°çš„æ€ªç‰©å‡ºç°äº†ï¼\",\n          isCritical: false\n        }, ...state.battleLogs.slice(0, 19)]\n      };\n      break;\n\n    // æ¢å¤ç©å®¶ç”Ÿå‘½å€¼\n    case 'RESET_PLAYER_HEALTH':\n      newState = {\n        ...state,\n        player: {\n          ...state.player,\n          currentHealth: state.player.maxHealth\n        },\n        battleLogs: [{\n          id: Date.now(),\n          text: `${state.player.name}æ¢å¤äº†å¥åº·ï¼`,\n          isCritical: false\n        }, ...state.battleLogs.slice(0, 19)]\n      };\n      break;\n\n    // åˆ‡æ¢æ¸¸æˆè¿è¡ŒçŠ¶æ€\n    case 'TOGGLE_GAME':\n      newState = {\n        ...state,\n        gameRunning: !state.gameRunning\n      };\n      break;\n    default:\n      return state;\n  }\n\n  // ä¿å­˜çŠ¶æ€åˆ°localStorage\n  localStorage.setItem('rpgGameState', JSON.stringify(newState));\n  return newState;\n}\n\n// åˆ›å»ºContext\nconst GameContext = /*#__PURE__*/createContext();\n\n// è‡ªå®šä¹‰é’©å­ï¼Œæ–¹ä¾¿ç»„ä»¶ä½¿ç”¨Context\nexport function useGame() {\n  _s();\n  return useContext(GameContext);\n}\n\n// Providerç»„ä»¶\n_s(useGame, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nexport function GameProvider({\n  children\n}) {\n  _s2();\n  const [state, dispatch] = useReducer(gameReducer, null, createInitialState);\n\n  // æˆ˜æ–—ä¼¤å®³è®¡ç®—\n  const calculateDamage = (attacker, defender) => {\n    // åŸºç¡€ä¼¤å®³ = æ”»å‡»åŠ› - é˜²å¾¡åŠ›/2\n    let baseDamage = Math.max(1, attacker.attack - defender.defense / 2);\n\n    // æ•æ·å½±å“å‘½ä¸­å’Œé—ªé¿\n    const agilityDiff = attacker.agility - defender.agility;\n\n    // å‘½ä¸­ç‡è°ƒæ•´ (åŠ æˆæˆ–å‡å°‘æœ€å¤š20%)\n    const hitRateAdjustment = Math.min(0.2, Math.max(-0.2, agilityDiff * 0.02));\n    const baseHitRate = 0.9; // åŸºç¡€90%å‘½ä¸­ç‡\n    const hitRate = Math.min(0.99, Math.max(0.7, baseHitRate + hitRateAdjustment));\n\n    // æ£€æŸ¥æ˜¯å¦å‘½ä¸­\n    if (Math.random() > hitRate) {\n      // é—ªé¿\n      return 0;\n    }\n\n    // éšæœºæ³¢åŠ¨ (Â±20%)\n    const randomFactor = 0.8 + Math.random() * 0.4;\n    return Math.floor(baseDamage * randomFactor);\n  };\n\n  // æ¸¸æˆä¸»å¾ªç¯\n  useEffect(() => {\n    // åªåœ¨æˆ˜æ–—åœºæ™¯ä¸”æ¸¸æˆæ­£åœ¨è¿è¡Œæ—¶æ‰§è¡Œæˆ˜æ–—å¾ªç¯\n    if (state.gameScene !== 'battle' || !state.gameRunning || !state.monster) return;\n    const gameLoop = setInterval(() => {\n      // æ£€æŸ¥ç©å®¶æ˜¯å¦æ­»äº¡\n      if (state.player.currentHealth <= 0) {\n        dispatch({\n          type: 'ADD_LOG',\n          payload: {\n            text: `æˆ˜æ–—å¤±è´¥ï¼${state.player.name}è¢«${state.monster.name}å‡»è´¥äº†ï¼`,\n            isCritical: true\n          }\n        });\n\n        // å»¶è¿Ÿåè¿”å›é€‰æ‹©é¡µé¢\n        setTimeout(() => {\n          dispatch({\n            type: 'RETURN_TO_SELECT'\n          });\n        }, 2000);\n        return;\n      }\n\n      // æ£€æŸ¥æ€ªç‰©æ˜¯å¦æ­»äº¡\n      if (state.monster.currentHealth <= 0) {\n        dispatch({\n          type: 'ADD_LOG',\n          payload: {\n            text: `æˆ˜æ–—èƒœåˆ©ï¼${state.player.name}å‡»è´¥äº†${state.monster.name}ï¼`,\n            isCritical: true\n          }\n        });\n\n        // è·å¾—ç»éªŒå€¼\n        dispatch({\n          type: 'PLAYER_GAIN_EXPERIENCE',\n          payload: {\n            experience: state.monster.expReward\n          }\n        });\n\n        // æ£€æŸ¥æ˜¯å¦æ‰è½è£…å¤‡\n        dispatch({\n          type: 'DROP_EQUIPMENT'\n        });\n\n        // æ¢å¤ç©å®¶è¡€é‡\n        setTimeout(() => {\n          dispatch({\n            type: 'RESET_PLAYER_HEALTH'\n          });\n        }, 1000);\n\n        // ç”Ÿæˆæ–°æ€ªç‰©\n        setTimeout(() => {\n          dispatch({\n            type: 'RESET_MONSTER'\n          });\n        }, 2000);\n        return;\n      }\n\n      // ç©å®¶æ”»å‡»\n      dispatch({\n        type: 'PLAYER_ATTACK'\n      });\n      setTimeout(() => {\n        dispatch({\n          type: 'PLAYER_ATTACK_END'\n        });\n        const isCritical = Math.random() < state.player.critChance;\n        let damage = calculateDamage(state.player, state.monster);\n        if (damage === 0) {\n          dispatch({\n            type: 'ADD_LOG',\n            payload: {\n              text: `${state.monster.name}é—ªé¿äº†${state.player.name}çš„æ”»å‡»ï¼`,\n              isCritical: false\n            }\n          });\n        } else {\n          if (isCritical) {\n            damage = Math.floor(damage * state.player.critMultiplier);\n          }\n          dispatch({\n            type: 'MONSTER_DAMAGE',\n            payload: {\n              damage,\n              isCritical\n            }\n          });\n        }\n        setTimeout(() => {\n          dispatch({\n            type: 'MONSTER_DAMAGE_END'\n          });\n\n          // æ€ªç‰©æ”»å‡» (å¦‚æœè¿˜æ´»ç€)\n          if (state.monster.currentHealth > 0) {\n            setTimeout(() => {\n              dispatch({\n                type: 'MONSTER_ATTACK'\n              });\n              setTimeout(() => {\n                dispatch({\n                  type: 'MONSTER_ATTACK_END'\n                });\n                const monsterCritical = Math.random() < state.monster.critChance;\n                let monsterDamage = calculateDamage(state.monster, state.player);\n                if (monsterDamage === 0) {\n                  dispatch({\n                    type: 'ADD_LOG',\n                    payload: {\n                      text: `${state.player.name}é—ªé¿äº†${state.monster.name}çš„æ”»å‡»ï¼`,\n                      isCritical: false\n                    }\n                  });\n                } else {\n                  if (monsterCritical) {\n                    monsterDamage = Math.floor(monsterDamage * state.monster.critMultiplier);\n                  }\n                  dispatch({\n                    type: 'PLAYER_DAMAGE',\n                    payload: {\n                      damage: monsterDamage,\n                      isCritical: monsterCritical\n                    }\n                  });\n                }\n                setTimeout(() => {\n                  dispatch({\n                    type: 'PLAYER_DAMAGE_END'\n                  });\n                }, 500);\n              }, 500);\n            }, 500);\n          }\n        }, 500);\n      }, 500);\n    }, state.gameSpeed);\n    return () => clearInterval(gameLoop);\n  }, [state.gameScene, state.gameRunning, state.player, state.monster, state.selectedBattlefield]);\n  const value = {\n    state,\n    dispatch,\n    calculateExpToNextLevel,\n    equipmentTypes,\n    rarities\n  };\n  return /*#__PURE__*/_jsxDEV(GameContext.Provider, {\n    value: value,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 1120,\n    columnNumber: 9\n  }, this);\n}\n_s2(GameProvider, \"KbKDpRykewaxcxtso3VhbHZxRso=\");\n_c = GameProvider;\nvar _c;\n$RefreshReg$(_c, \"GameProvider\");","map":{"version":3,"names":["React","createContext","useContext","useReducer","useEffect","jsxDEV","_jsxDEV","battlefields","id","name","levelRange","background","description","equipmentTypes","HEAD","emoji","slot","BODY","BELT","SHOES","WEAPON","NECKLACE","ACCESSORY","rarities","COMMON","color","chance","multiplier","UNCOMMON","RARE","EPIC","LEGENDARY","attributeTypes","HEALTH","min","max","scaling","ATTACK","DEFENSE","AGILITY","CRIT_CHANCE","equipmentAttributes","generateEquipment","playerLevel","dropRateBonus","equipLevel","Math","floor","random","equipTypeKeys","Object","keys","randomType","length","rarityRoll","selectedRarity","attrCount","possibleAttributes","shuffledAttributes","sort","selectedAttributes","slice","attributes","forEach","attrKey","attr","baseValue","levelScaling","value","round","prefixes","randomPrefix","Date","now","type","level","rarity","rarityName","rarityColor","generateMonster","battlefieldId","minLevel","maxLevel","battlefield","find","bf","monsterLevel","monsterTypes","baseHealth","baseAttack","baseDefense","baseAgility","availableMonsters","monsterType","levelMultiplier","maxHealth","currentHealth","attack","defense","agility","critChance","critMultiplier","expReward","dropChance","calculateExpToNextLevel","pow","calculateEquipmentStats","equipment","stats","health","values","equip","entries","key","createInitialState","savedState","localStorage","getItem","parsedState","JSON","parse","inventory","maxSlots","items","modal","isOpen","data","head","body","belt","shoes","weapon","necklace","accessory","e","console","error","gameScene","selectedBattlefield","player","experience","expToNextLevel","contextMenu","position","x","y","item","monster","battleLogs","playerAttacking","monsterAttacking","playerDamaged","monsterDamaged","gameSpeed","gameRunning","gameReducer","state","action","newState","payload","text","isCritical","existingEquipment","newInventory","filter","invItem","count","existingInvItem","i","push","newEquipment","equipStats","basePlayer","updatedPlayer","existingItem","damage","expGained","leveledUp","healthIncrease","newLogs","randomRoll","setItem","stringify","GameContext","useGame","_s","GameProvider","children","_s2","dispatch","calculateDamage","attacker","defender","baseDamage","agilityDiff","hitRateAdjustment","baseHitRate","hitRate","randomFactor","gameLoop","setInterval","setTimeout","monsterCritical","monsterDamage","clearInterval","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["D:/mm-rpg-react/src/contexts/GameContext.js"],"sourcesContent":["import React, { createContext, useContext, useReducer, useEffect } from 'react';\r\n\r\n// æˆ˜åœºé…ç½®\r\nconst battlefields = [\r\n    {\r\n        id: 'novice',\r\n        name: 'æ–°æ‰‹æ‘',\r\n        levelRange: [1, 10],\r\n        background: '#e6f7ff',\r\n        description: 'é€‚åˆ1-10çº§ç©å®¶çš„æ–°æ‰‹æˆ˜åœº'\r\n    },\r\n    {\r\n        id: 'intermediate',\r\n        name: 'è¿›é˜¶æ£®æ—',\r\n        levelRange: [11, 20],\r\n        background: '#e6ffe6',\r\n        description: 'é€‚åˆ11-20çº§ç©å®¶çš„è¿›é˜¶æˆ˜åœº'\r\n    },\r\n    {\r\n        id: 'hell',\r\n        name: 'åœ°ç‹±çº§éš¾åº¦',\r\n        levelRange: [21, 30],\r\n        background: '#ffe6e6',\r\n        description: 'é€‚åˆ21-30çº§ç©å®¶çš„é«˜éš¾åº¦æˆ˜åœº'\r\n    }\r\n];\r\n\r\n// è£…å¤‡ç±»å‹å®šä¹‰\r\nconst equipmentTypes = {\r\n    HEAD: { id: 'HEAD', name: 'å¤´éƒ¨', emoji: 'ğŸ§¢', slot: 'head' },\r\n    BODY: { id: 'BODY', name: 'èº«ä½“', emoji: 'ğŸ‘•', slot: 'body' },\r\n    BELT: { id: 'BELT', name: 'è…°å¸¦', emoji: 'ğŸ§¶', slot: 'belt' },\r\n    SHOES: { id: 'SHOES', name: 'é‹å­', emoji: 'ğŸ‘', slot: 'shoes' },\r\n    WEAPON: { id: 'WEAPON', name: 'æ­¦å™¨', emoji: 'ğŸ—¡ï¸', slot: 'weapon' },\r\n    NECKLACE: { id: 'NECKLACE', name: 'é¡¹é“¾', emoji: 'ğŸ“¿', slot: 'necklace' },\r\n    ACCESSORY: { id: 'ACCESSORY', name: 'é¦–é¥°', emoji: 'ğŸ’', slot: 'accessory' }\r\n};\r\n\r\n// è£…å¤‡ç¨€æœ‰åº¦å®šä¹‰\r\nconst rarities = {\r\n    COMMON: { id: 'COMMON', name: 'æ™®é€š', color: '#a0a0a0', chance: 0.6, multiplier: 1 },\r\n    UNCOMMON: { id: 'UNCOMMON', name: 'ä¼˜ç§€', color: '#1eff00', chance: 0.3, multiplier: 1.5 },\r\n    RARE: { id: 'RARE', name: 'ç²¾è‰¯', color: '#0070dd', chance: 0.08, multiplier: 2 },\r\n    EPIC: { id: 'EPIC', name: 'å²è¯—', color: '#a335ee', chance: 0.02, multiplier: 2.5 },\r\n    LEGENDARY: { id: 'LEGENDARY', name: 'ä¼ è¯´', color: '#ff8000', chance: 0.004, multiplier: 3 }\r\n};\r\n\r\n// è£…å¤‡å±æ€§å®šä¹‰\r\nconst attributeTypes = {\r\n    HEALTH: { id: 'HEALTH', name: 'ç”Ÿå‘½å€¼', min: 5, max: 20, scaling: 2 },\r\n    ATTACK: { id: 'ATTACK', name: 'æ”»å‡»åŠ›', min: 1, max: 5, scaling: 0.5 },\r\n    DEFENSE: { id: 'DEFENSE', name: 'é˜²å¾¡åŠ›', min: 1, max: 3, scaling: 0.3 },\r\n    AGILITY: { id: 'AGILITY', name: 'æ•æ·åº¦', min: 1, max: 3, scaling: 0.3 },\r\n    CRIT_CHANCE: { id: 'CRIT_CHANCE', name: 'æš´å‡»ç‡', min: 0.01, max: 0.03, scaling: 0.003 }\r\n};\r\n\r\n// æŒ‰è£…å¤‡ç±»å‹åˆ’åˆ†å¯èƒ½çš„å±æ€§ (æŸäº›å±æ€§åªåœ¨ç‰¹å®šè£…å¤‡ä¸Šå‡ºç°)\r\nconst equipmentAttributes = {\r\n    HEAD: ['HEALTH', 'DEFENSE'],\r\n    BODY: ['HEALTH', 'DEFENSE'],\r\n    BELT: ['HEALTH', 'AGILITY'],\r\n    SHOES: ['AGILITY', 'DEFENSE'],\r\n    WEAPON: ['ATTACK', 'CRIT_CHANCE'],\r\n    NECKLACE: ['HEALTH', 'CRIT_CHANCE'],\r\n    ACCESSORY: ['ATTACK', 'AGILITY', 'CRIT_CHANCE']\r\n};\r\n\r\n// éšæœºç”Ÿæˆè£…å¤‡\r\nconst generateEquipment = (playerLevel, dropRateBonus = 0) => {\r\n    // è£…å¤‡ç­‰çº§èŒƒå›´\r\n    const equipLevel = Math.max(1, Math.floor(playerLevel * (0.8 + Math.random() * 0.4)));\r\n\r\n    // éšæœºè£…å¤‡ç±»å‹\r\n    const equipTypeKeys = Object.keys(equipmentTypes);\r\n    const randomType = equipmentTypes[equipTypeKeys[Math.floor(Math.random() * equipTypeKeys.length)]];\r\n\r\n    // éšæœºç¨€æœ‰åº¦ (ä½¿ç”¨æ¦‚ç‡æƒé‡)\r\n    let rarityRoll = Math.random() - dropRateBonus; // æ‰è½ç‡åŠ æˆæé«˜ç¨€æœ‰åº¦æ¦‚ç‡\r\n    rarityRoll = Math.max(0, rarityRoll); // ç¡®ä¿ä¸ä¼šæ˜¯è´Ÿæ•°\r\n\r\n    let selectedRarity;\r\n    if (rarityRoll < rarities.LEGENDARY.chance) {\r\n        selectedRarity = rarities.LEGENDARY;\r\n    } else if (rarityRoll < rarities.EPIC.chance + rarities.LEGENDARY.chance) {\r\n        selectedRarity = rarities.EPIC;\r\n    } else if (rarityRoll < rarities.RARE.chance + rarities.EPIC.chance + rarities.LEGENDARY.chance) {\r\n        selectedRarity = rarities.RARE;\r\n    } else if (rarityRoll < rarities.UNCOMMON.chance + rarities.RARE.chance + rarities.EPIC.chance + rarities.LEGENDARY.chance) {\r\n        selectedRarity = rarities.UNCOMMON;\r\n    } else {\r\n        selectedRarity = rarities.COMMON;\r\n    }\r\n\r\n    // ç¡®å®šå±æ€§æ•°é‡ (åŸºäºç¨€æœ‰åº¦)\r\n    const attrCount = Math.floor(Math.random() * 2) + 1; // 1-2ä¸ªå±æ€§\r\n\r\n    // éšæœºé€‰æ‹©å±æ€§\r\n    const possibleAttributes = equipmentAttributes[randomType.id];\r\n    const shuffledAttributes = [...possibleAttributes].sort(() => 0.5 - Math.random());\r\n    const selectedAttributes = shuffledAttributes.slice(0, attrCount);\r\n\r\n    // ä¸ºæ¯ä¸ªå±æ€§éšæœºç”Ÿæˆæ•°å€¼\r\n    const attributes = {};\r\n    selectedAttributes.forEach(attrKey => {\r\n        const attr = attributeTypes[attrKey];\r\n        // åŸºç¡€å±æ€§å€¼ + ç­‰çº§ç¼©æ”¾ * ç¨€æœ‰åº¦å€ç‡\r\n        const baseValue = attr.min + Math.random() * (attr.max - attr.min);\r\n        const levelScaling = attr.scaling * equipLevel;\r\n        let value = (baseValue + levelScaling) * selectedRarity.multiplier;\r\n\r\n        // å¯¹æš´å‡»ç‡è¿›è¡Œç‰¹æ®Šå¤„ç†ï¼Œç¡®ä¿ä¸è¶…è¿‡åˆç†èŒƒå›´\r\n        if (attrKey === 'CRIT_CHANCE') {\r\n            value = Math.min(value, 0.25); // æœ€é«˜25%æš´å‡»ç‡\r\n            value = Math.round(value * 1000) / 1000; // ä¿ç•™3ä½å°æ•°\r\n        } else {\r\n            value = Math.floor(value); // å…¶ä»–å±æ€§å–æ•´\r\n        }\r\n\r\n        attributes[attrKey] = value;\r\n    });\r\n\r\n    // ç”Ÿæˆè£…å¤‡åç§°\r\n    const prefixes = [\r\n        'é”‹åˆ©çš„', 'åšå›ºçš„', 'é—ªäº®çš„', 'ç ´æ—§çš„', 'ç¥ç§˜çš„',\r\n        'å¤è€çš„', 'å¼ºåŒ–çš„', 'ç²¾åˆ¶çš„', 'é­”æ³•çš„', 'ä¼ æ‰¿çš„'\r\n    ];\r\n    const randomPrefix = prefixes[Math.floor(Math.random() * prefixes.length)];\r\n    const name = `${randomPrefix} ${randomType.name}`;\r\n\r\n    // ç”Ÿæˆå”¯ä¸€ID\r\n    const id = `equip_${Date.now()}_${Math.floor(Math.random() * 1000)}`;\r\n\r\n    return {\r\n        id,\r\n        name,\r\n        type: randomType.id,\r\n        emoji: randomType.emoji,\r\n        slot: randomType.slot,\r\n        level: equipLevel,\r\n        rarity: selectedRarity.id,\r\n        rarityName: selectedRarity.name,\r\n        rarityColor: selectedRarity.color,\r\n        attributes\r\n    };\r\n};\r\n\r\n// æ€ªç‰©é…ç½®ï¼ˆæ ¹æ®ç­‰çº§ç”Ÿæˆï¼‰\r\nconst generateMonster = (playerLevel, battlefieldId) => {\r\n    // æ ¹æ®æˆ˜åœºç¡®å®šæ€ªç‰©ç­‰çº§èŒƒå›´\r\n    let minLevel = playerLevel - 2;\r\n    let maxLevel = playerLevel + 2;\r\n    const battlefield = battlefields.find(bf => bf.id === battlefieldId);\r\n\r\n    // ç¡®ä¿æ€ªç‰©ç­‰çº§åœ¨æˆ˜åœºèŒƒå›´å†…\r\n    if (battlefield) {\r\n        minLevel = Math.max(minLevel, battlefield.levelRange[0]);\r\n        maxLevel = Math.min(maxLevel, battlefield.levelRange[1]);\r\n    }\r\n\r\n    // éšæœºç¡®å®šæ€ªç‰©ç­‰çº§\r\n    const monsterLevel = Math.floor(Math.random() * (maxLevel - minLevel + 1)) + minLevel;\r\n\r\n    // æ€ªç‰©ç±»å‹\r\n    const monsterTypes = [\r\n        { name: 'å²è±å§†', emoji: 'ğŸŸ¢', baseHealth: 50, baseAttack: 5, baseDefense: 2, baseAgility: 1 },\r\n        { name: 'è™è ', emoji: 'ğŸ¦‡', baseHealth: 40, baseAttack: 7, baseDefense: 1, baseAgility: 5 },\r\n        { name: 'éª·é«…', emoji: 'ğŸ’€', baseHealth: 60, baseAttack: 6, baseDefense: 3, baseAgility: 2 },\r\n        { name: 'èœ˜è››', emoji: 'ğŸ•·ï¸', baseHealth: 45, baseAttack: 6, baseDefense: 2, baseAgility: 4 },\r\n        { name: 'å¹½çµ', emoji: 'ğŸ‘»', baseHealth: 55, baseAttack: 8, baseDefense: 0, baseAgility: 6 },\r\n        { name: 'å·¨é­”', emoji: 'ğŸ‘¹', baseHealth: 70, baseAttack: 9, baseDefense: 4, baseAgility: 1 },\r\n        { name: 'æ¶é­”', emoji: 'ğŸ˜ˆ', baseHealth: 65, baseAttack: 10, baseDefense: 3, baseAgility: 3 }\r\n    ];\r\n\r\n    // æ ¹æ®æˆ˜åœºéš¾åº¦é€‰æ‹©æ€ªç‰©\r\n    let availableMonsters;\r\n    if (battlefieldId === 'novice') {\r\n        availableMonsters = monsterTypes.slice(0, 3); // ç®€å•æ€ªç‰©\r\n    } else if (battlefieldId === 'intermediate') {\r\n        availableMonsters = monsterTypes.slice(2, 5); // ä¸­ç­‰æ€ªç‰©\r\n    } else {\r\n        availableMonsters = monsterTypes.slice(4); // å›°éš¾æ€ªç‰©\r\n    }\r\n\r\n    // éšæœºé€‰æ‹©ä¸€ç§æ€ªç‰©\r\n    const monsterType = availableMonsters[Math.floor(Math.random() * availableMonsters.length)];\r\n\r\n    // åŸºäºç­‰çº§è®¡ç®—æ€ªç‰©å±æ€§\r\n    const levelMultiplier = 1 + (monsterLevel - 1) * 0.1; // æ¯çº§æå‡10%\r\n\r\n    return {\r\n        name: `${monsterLevel}çº§${monsterType.name}`,\r\n        emoji: monsterType.emoji,\r\n        level: monsterLevel,\r\n        maxHealth: Math.floor(monsterType.baseHealth * levelMultiplier),\r\n        currentHealth: Math.floor(monsterType.baseHealth * levelMultiplier),\r\n        attack: Math.floor(monsterType.baseAttack * levelMultiplier),\r\n        defense: Math.floor(monsterType.baseDefense * levelMultiplier),\r\n        agility: Math.floor(monsterType.baseAgility * levelMultiplier),\r\n        critChance: 0.1 + monsterLevel * 0.005, // åŸºç¡€10%ï¼Œæ¯çº§+0.5%\r\n        critMultiplier: 1.5,\r\n        // æ€ªç‰©ç»éªŒå€¼ï¼šåŸºç¡€å€¼ + ç­‰çº§åŠ æˆ\r\n        expReward: 10 + monsterLevel * 5,\r\n        // æ‰è½è£…å¤‡æ¦‚ç‡ (20% + ç­‰çº§åŠ æˆ)\r\n        dropChance: 0.2 + monsterLevel * 0.01\r\n    };\r\n};\r\n\r\n// è®¡ç®—å‡çº§æ‰€éœ€ç»éªŒ\r\nconst calculateExpToNextLevel = (level) => {\r\n    // ä½¿ç”¨æŒ‡æ•°å¢é•¿å…¬å¼: 100 * (level)^1.5\r\n    return Math.floor(100 * Math.pow(level, 1.5));\r\n};\r\n\r\n// è®¡ç®—è£…å¤‡æä¾›çš„å±æ€§æ€»å’Œ\r\nconst calculateEquipmentStats = (equipment) => {\r\n    const stats = {\r\n        health: 0,\r\n        attack: 0,\r\n        defense: 0,\r\n        agility: 0,\r\n        critChance: 0\r\n    };\r\n\r\n    // éå†æ‰€æœ‰è£…å¤‡æ§½ä½\r\n    Object.values(equipment).forEach(equip => {\r\n        if (!equip) return; // å¦‚æœæ§½ä½æ²¡æœ‰è£…å¤‡\r\n\r\n        // ç´¯åŠ è£…å¤‡å±æ€§\r\n        Object.entries(equip.attributes).forEach(([key, value]) => {\r\n            switch (key) {\r\n                case 'HEALTH':\r\n                    stats.health += value;\r\n                    break;\r\n                case 'ATTACK':\r\n                    stats.attack += value;\r\n                    break;\r\n                case 'DEFENSE':\r\n                    stats.defense += value;\r\n                    break;\r\n                case 'AGILITY':\r\n                    stats.agility += value;\r\n                    break;\r\n                case 'CRIT_CHANCE':\r\n                    stats.critChance += value;\r\n                    break;\r\n                default:\r\n                    break;\r\n            }\r\n        });\r\n    });\r\n\r\n    return stats;\r\n};\r\n\r\n// åˆå§‹çŠ¶æ€\r\n// åˆå§‹çŠ¶æ€\r\nconst createInitialState = () => {\r\n    try {\r\n        // å°è¯•ä»localStorageè¯»å–ä¿å­˜çš„çŠ¶æ€\r\n        const savedState = localStorage.getItem('rpgGameState');\r\n        if (savedState) {\r\n            const parsedState = JSON.parse(savedState);\r\n\r\n            // æ£€æŸ¥å¹¶ç¡®ä¿æ‰€æœ‰å…³é”®å±æ€§éƒ½å­˜åœ¨ï¼Œå¦‚æœä¸å­˜åœ¨åˆ™ä½¿ç”¨é»˜è®¤å€¼\r\n            // ç¡®ä¿inventoryå­˜åœ¨\r\n            if (!parsedState.inventory) {\r\n                parsedState.inventory = {\r\n                    maxSlots: 20,\r\n                    items: []\r\n                };\r\n            }\r\n\r\n            // ç¡®ä¿modalå­˜åœ¨\r\n            if (!parsedState.modal) {\r\n                parsedState.modal = {\r\n                    isOpen: false,\r\n                    type: null,\r\n                    data: null\r\n                };\r\n            }\r\n\r\n            // ç¡®ä¿equipmentå­˜åœ¨\r\n            if (!parsedState.equipment) {\r\n                parsedState.equipment = {\r\n                    head: null,\r\n                    body: null,\r\n                    belt: null,\r\n                    shoes: null,\r\n                    weapon: null,\r\n                    necklace: null,\r\n                    accessory: null\r\n                };\r\n            }\r\n\r\n            return parsedState;\r\n        }\r\n    } catch (e) {\r\n        console.error('Failed to parse saved game state:', e);\r\n    }\r\n\r\n    // é»˜è®¤åˆå§‹çŠ¶æ€\r\n    return {\r\n        // æ¸¸æˆåœºæ™¯çŠ¶æ€: 'select' - æˆ˜åœºé€‰æ‹©é¡µé¢, 'battle' - æˆ˜æ–—é¡µé¢\r\n        gameScene: 'select',\r\n        selectedBattlefield: null,\r\n\r\n        // è§’è‰²åŸºç¡€å±æ€§\r\n        player: {\r\n            name: \"å‹‡è€…\",\r\n            level: 1,\r\n            experience: 0,\r\n            expToNextLevel: calculateExpToNextLevel(1),\r\n            maxHealth: 100,\r\n            currentHealth: 100,\r\n            attack: 10,\r\n            defense: 5,\r\n            agility: 3, // æ–°å¢æ•æ·åº¦å±æ€§\r\n            critChance: 0.1,\r\n            critMultiplier: 1.5\r\n        },\r\n\r\n        // è£…å¤‡ç³»ç»Ÿ\r\n        equipment: {\r\n            head: null,\r\n            body: null,\r\n            belt: null,\r\n            shoes: null,\r\n            weapon: null,\r\n            necklace: null,\r\n            accessory: null\r\n        },\r\n\r\n        // ç‰©å“æ \r\n        inventory: {\r\n            maxSlots: 20, // ç‰©å“æ æœ€å¤§æ ¼å­æ•°\r\n            items: [] // ç‰©å“åˆ—è¡¨ï¼Œæ¯ä¸ªç‰©å“åŒ…å« {id, count, ...itemData}\r\n        },\r\n\r\n        // æ¨¡æ€çª—å£çŠ¶æ€\r\n        modal: {\r\n            isOpen: false,\r\n            type: null, // 'character', 'equipment', 'inventory'\r\n            data: null\r\n        },\r\n\r\n        // ç‰©å“å³é”®èœå•çŠ¶æ€\r\n        contextMenu: {\r\n            isOpen: false,\r\n            position: { x: 0, y: 0 },\r\n            item: null\r\n        },\r\n\r\n        monster: null,\r\n\r\n        battleLogs: [],\r\n        playerAttacking: false,\r\n        monsterAttacking: false,\r\n        playerDamaged: false,\r\n        monsterDamaged: false,\r\n        gameSpeed: 2000, // æ¯å›åˆé—´éš”(æ¯«ç§’)\r\n        gameRunning: true,\r\n        battlefields: battlefields\r\n    };\r\n};\r\n\r\n// Reducerå‡½æ•°æ¥å¤„ç†çŠ¶æ€æ›´æ–°\r\nfunction gameReducer(state, action) {\r\n    let newState;\r\n\r\n    switch (action.type) {\r\n        // é€‰æ‹©æˆ˜åœº\r\n        case 'SELECT_BATTLEFIELD':\r\n            newState = {\r\n                ...state,\r\n                gameScene: 'battle',\r\n                selectedBattlefield: action.payload,\r\n                battleLogs: [{\r\n                    id: Date.now(),\r\n                    text: `è¿›å…¥${action.payload.name}æˆ˜åœºï¼`,\r\n                    isCritical: false\r\n                }],\r\n                // ç”Ÿæˆæ–°æ€ªç‰©\r\n                monster: generateMonster(state.player.level, action.payload.id)\r\n            };\r\n            break;\r\n\r\n        // è¿”å›é€‰æ‹©é¡µé¢\r\n        case 'RETURN_TO_SELECT':\r\n            newState = {\r\n                ...state,\r\n                gameScene: 'select',\r\n                monster: null,\r\n                battleLogs: []\r\n            };\r\n            break;\r\n\r\n        // æ‰“å¼€æ¨¡æ€çª—å£\r\n        case 'OPEN_MODAL':\r\n            newState = {\r\n                ...state,\r\n                modal: {\r\n                    isOpen: true,\r\n                    type: action.payload.type,\r\n                    data: action.payload.data || null\r\n                }\r\n            };\r\n            break;\r\n\r\n        // å…³é—­æ¨¡æ€çª—å£\r\n        case 'CLOSE_MODAL':\r\n            newState = {\r\n                ...state,\r\n                modal: {\r\n                    ...state.modal,\r\n                    isOpen: false\r\n                }\r\n            };\r\n            break;\r\n\r\n        // æ‰“å¼€å³é”®èœå•\r\n        case 'OPEN_CONTEXT_MENU':\r\n            newState = {\r\n                ...state,\r\n                contextMenu: {\r\n                    isOpen: true,\r\n                    position: action.payload.position,\r\n                    item: action.payload.item\r\n                }\r\n            };\r\n            break;\r\n\r\n        // å…³é—­å³é”®èœå•\r\n        case 'CLOSE_CONTEXT_MENU':\r\n            newState = {\r\n                ...state,\r\n                contextMenu: {\r\n                    ...state.contextMenu,\r\n                    isOpen: false\r\n                }\r\n            };\r\n            break;\r\n\r\n        // è£…å¤‡ç‰©å“\r\n        case 'EQUIP_ITEM':\r\n            {\r\n                const item = action.payload;\r\n                const { slot } = item;\r\n\r\n                // æ£€æŸ¥æ˜¯å¦å·²ç»æœ‰è£…å¤‡åœ¨è¯¥æ§½ä½\r\n                const existingEquipment = state.equipment[slot];\r\n                let newInventory = { ...state.inventory };\r\n\r\n                // ä»ç‰©å“æ ç§»é™¤è¦è£…å¤‡çš„ç‰©å“\r\n                newInventory.items = newInventory.items.filter(invItem => {\r\n                    if (invItem.id === item.id) {\r\n                        if (invItem.count > 1) {\r\n                            invItem.count--;\r\n                            return true;\r\n                        }\r\n                        return false;\r\n                    }\r\n                    return true;\r\n                });\r\n\r\n                // å¦‚æœæ§½ä½å·²æœ‰è£…å¤‡ï¼Œå°†å…¶æ”¾å›ç‰©å“æ \r\n                if (existingEquipment) {\r\n                    // æ£€æŸ¥ç‰©å“æ æ˜¯å¦å·²æœ‰ç›¸åŒç‰©å“\r\n                    const existingInvItem = newInventory.items.find(i =>\r\n                        i.id === existingEquipment.id ||\r\n                        (i.name === existingEquipment.name && i.level === existingEquipment.level)\r\n                    );\r\n\r\n                    if (existingInvItem) {\r\n                        existingInvItem.count++;\r\n                    } else {\r\n                        // æ£€æŸ¥ç‰©å“æ æ˜¯å¦å·²æ»¡\r\n                        if (newInventory.items.length < newInventory.maxSlots) {\r\n                            newInventory.items.push({ ...existingEquipment, count: 1 });\r\n                        } else {\r\n                            // å¦‚æœæ»¡äº†ï¼Œæ·»åŠ æç¤º\r\n                            newState = {\r\n                                ...state,\r\n                                battleLogs: [\r\n                                    {\r\n                                        id: Date.now(),\r\n                                        text: `ç‰©å“æ å·²æ»¡ï¼Œæ— æ³•å¸ä¸‹${existingEquipment.name}ï¼`,\r\n                                        isCritical: true\r\n                                    },\r\n                                    ...state.battleLogs.slice(0, 19)\r\n                                ]\r\n                            };\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n\r\n                // åˆ›å»ºæ–°çš„è£…å¤‡çŠ¶æ€\r\n                const newEquipment = {\r\n                    ...state.equipment,\r\n                    [slot]: { ...item, count: 1 }\r\n                };\r\n\r\n                // è·å–æ–°çš„è£…å¤‡åŠ æˆ\r\n                const equipStats = calculateEquipmentStats(newEquipment);\r\n\r\n                // æ›´æ–°ç©å®¶å±æ€§ï¼ˆåŸºç¡€å±æ€§+è£…å¤‡åŠ æˆï¼‰\r\n                const basePlayer = { ...state.player };\r\n                const updatedPlayer = {\r\n                    ...basePlayer,\r\n                    maxHealth: basePlayer.maxHealth + equipStats.health,\r\n                    currentHealth: Math.min(basePlayer.currentHealth + equipStats.health, basePlayer.maxHealth + equipStats.health),\r\n                    attack: basePlayer.attack + equipStats.attack,\r\n                    defense: basePlayer.defense + equipStats.defense,\r\n                    agility: basePlayer.agility + equipStats.agility,\r\n                    critChance: basePlayer.critChance + equipStats.critChance\r\n                };\r\n\r\n                newState = {\r\n                    ...state,\r\n                    equipment: newEquipment,\r\n                    inventory: newInventory,\r\n                    player: updatedPlayer,\r\n                    battleLogs: [\r\n                        {\r\n                            id: Date.now(),\r\n                            text: `è£…å¤‡äº†${item.name}ï¼`,\r\n                            isCritical: false\r\n                        },\r\n                        ...state.battleLogs.slice(0, 19)\r\n                    ]\r\n                };\r\n            }\r\n            break;\r\n\r\n        // å¸ä¸‹è£…å¤‡\r\n        case 'UNEQUIP_ITEM':\r\n            {\r\n                const slot = action.payload;\r\n                const item = state.equipment[slot];\r\n\r\n                if (!item) {\r\n                    newState = state;\r\n                    break;\r\n                }\r\n\r\n                // æ£€æŸ¥ç‰©å“æ æ˜¯å¦å·²æ»¡\r\n                if (state.inventory.items.length >= state.inventory.maxSlots) {\r\n                    newState = {\r\n                        ...state,\r\n                        battleLogs: [\r\n                            {\r\n                                id: Date.now(),\r\n                                text: `ç‰©å“æ å·²æ»¡ï¼Œæ— æ³•å¸ä¸‹${item.name}ï¼`,\r\n                                isCritical: true\r\n                            },\r\n                            ...state.battleLogs.slice(0, 19)\r\n                        ]\r\n                    };\r\n                    break;\r\n                }\r\n\r\n                // æ£€æŸ¥ç‰©å“æ æ˜¯å¦å·²æœ‰ç›¸åŒç‰©å“\r\n                let newInventory = { ...state.inventory };\r\n                const existingItem = newInventory.items.find(i =>\r\n                    i.id === item.id ||\r\n                    (i.name === item.name && i.level === item.level)\r\n                );\r\n\r\n                if (existingItem) {\r\n                    existingItem.count++;\r\n                } else {\r\n                    newInventory.items.push({ ...item, count: 1 });\r\n                }\r\n\r\n                // åˆ›å»ºæ–°çš„è£…å¤‡çŠ¶æ€\r\n                const newEquipment = {\r\n                    ...state.equipment,\r\n                    [slot]: null\r\n                };\r\n\r\n                // è·å–æ–°çš„è£…å¤‡åŠ æˆ\r\n                const equipStats = calculateEquipmentStats(newEquipment);\r\n\r\n                // æ›´æ–°ç©å®¶å±æ€§ï¼ˆåŸºç¡€å±æ€§+è£…å¤‡åŠ æˆï¼‰\r\n                const basePlayer = { ...state.player };\r\n                const updatedPlayer = {\r\n                    ...basePlayer,\r\n                    maxHealth: basePlayer.maxHealth - equipStats.health,\r\n                    currentHealth: Math.min(basePlayer.currentHealth, basePlayer.maxHealth - equipStats.health),\r\n                    attack: basePlayer.attack - equipStats.attack,\r\n                    defense: basePlayer.defense - equipStats.defense,\r\n                    agility: basePlayer.agility - equipStats.agility,\r\n                    critChance: basePlayer.critChance - equipStats.critChance\r\n                };\r\n\r\n                newState = {\r\n                    ...state,\r\n                    equipment: newEquipment,\r\n                    inventory: newInventory,\r\n                    player: updatedPlayer,\r\n                    battleLogs: [\r\n                        {\r\n                            id: Date.now(),\r\n                            text: `å¸ä¸‹äº†${item.name}ï¼`,\r\n                            isCritical: false\r\n                        },\r\n                        ...state.battleLogs.slice(0, 19)\r\n                    ]\r\n                };\r\n            }\r\n            break;\r\n\r\n        // ä¸¢å¼ƒç‰©å“\r\n        case 'DISCARD_ITEM':\r\n            {\r\n                const item = action.payload;\r\n\r\n                // ä»ç‰©å“æ ç§»é™¤ç‰©å“\r\n                const newInventory = { ...state.inventory };\r\n                newInventory.items = newInventory.items.filter(invItem => invItem.id !== item.id);\r\n\r\n                newState = {\r\n                    ...state,\r\n                    inventory: newInventory,\r\n                    battleLogs: [\r\n                        {\r\n                            id: Date.now(),\r\n                            text: `ä¸¢å¼ƒäº†${item.name} x${item.count}ï¼`,\r\n                            isCritical: false\r\n                        },\r\n                        ...state.battleLogs.slice(0, 19)\r\n                    ]\r\n                };\r\n            }\r\n            break;\r\n\r\n        // è·å¾—ç‰©å“\r\n        case 'GAIN_ITEM':\r\n            {\r\n                const item = action.payload;\r\n\r\n                // æ£€æŸ¥ç‰©å“æ æ˜¯å¦å·²æ»¡\r\n                if (state.inventory.items.length >= state.inventory.maxSlots) {\r\n                    // ç‰©å“æ å·²æ»¡ï¼Œæ— æ³•è·å¾—ç‰©å“\r\n                    newState = {\r\n                        ...state,\r\n                        battleLogs: [\r\n                            {\r\n                                id: Date.now(),\r\n                                text: `ç‰©å“æ å·²æ»¡ï¼Œæ— æ³•è·å¾—${item.name}ï¼`,\r\n                                isCritical: true\r\n                            },\r\n                            ...state.battleLogs.slice(0, 19)\r\n                        ]\r\n                    };\r\n                    break;\r\n                }\r\n\r\n                // æ£€æŸ¥ç‰©å“æ æ˜¯å¦å·²æœ‰ç›¸åŒç‰©å“\r\n                const newInventory = { ...state.inventory };\r\n                const existingItem = newInventory.items.find(i =>\r\n                    i.id === item.id ||\r\n                    (i.name === item.name && i.level === item.level && i.rarity === item.rarity)\r\n                );\r\n\r\n                if (existingItem) {\r\n                    // å¦‚æœå·²æœ‰ç›¸åŒç‰©å“ï¼Œå¢åŠ æ•°é‡\r\n                    existingItem.count++;\r\n                } else {\r\n                    // å¦åˆ™æ·»åŠ æ–°ç‰©å“\r\n                    newInventory.items.push({ ...item, count: 1 });\r\n                }\r\n\r\n                newState = {\r\n                    ...state,\r\n                    inventory: newInventory,\r\n                    battleLogs: [\r\n                        {\r\n                            id: Date.now(),\r\n                            text: `è·å¾—äº†${item.name}ï¼`,\r\n                            isCritical: false\r\n                        },\r\n                        ...state.battleLogs.slice(0, 19)\r\n                    ]\r\n                };\r\n            }\r\n            break;\r\n\r\n        // ç©å®¶æ”»å‡»\r\n        case 'PLAYER_ATTACK':\r\n            newState = {\r\n                ...state,\r\n                playerAttacking: true\r\n            };\r\n            break;\r\n\r\n        // ç©å®¶æ”»å‡»ç»“æŸ\r\n        case 'PLAYER_ATTACK_END':\r\n            newState = {\r\n                ...state,\r\n                playerAttacking: false\r\n            };\r\n            break;\r\n\r\n        // æ€ªç‰©å—ä¼¤\r\n        case 'MONSTER_DAMAGE':\r\n            newState = {\r\n                ...state,\r\n                monsterDamaged: true,\r\n                monster: {\r\n                    ...state.monster,\r\n                    currentHealth: Math.max(0, state.monster.currentHealth - action.payload.damage)\r\n                },\r\n                battleLogs: [\r\n                    {\r\n                        id: Date.now(),\r\n                        text: action.payload.isCritical\r\n                            ? `æš´å‡»ï¼${state.player.name}å¯¹${state.monster.name}é€ æˆäº†${action.payload.damage}ç‚¹ä¼¤å®³ï¼`\r\n                            : `${state.player.name}å¯¹${state.monster.name}é€ æˆäº†${action.payload.damage}ç‚¹ä¼¤å®³ã€‚`,\r\n                        isCritical: action.payload.isCritical\r\n                    },\r\n                    ...state.battleLogs.slice(0, 19)\r\n                ]\r\n            };\r\n            break;\r\n\r\n        // æ€ªç‰©å—ä¼¤ç»“æŸ\r\n        case 'MONSTER_DAMAGE_END':\r\n            newState = {\r\n                ...state,\r\n                monsterDamaged: false\r\n            };\r\n            break;\r\n\r\n        // æ€ªç‰©æ”»å‡»\r\n        case 'MONSTER_ATTACK':\r\n            newState = {\r\n                ...state,\r\n                monsterAttacking: true\r\n            };\r\n            break;\r\n\r\n        // æ€ªç‰©æ”»å‡»ç»“æŸ\r\n        case 'MONSTER_ATTACK_END':\r\n            newState = {\r\n                ...state,\r\n                monsterAttacking: false\r\n            };\r\n            break;\r\n\r\n        // ç©å®¶å—ä¼¤\r\n        case 'PLAYER_DAMAGE':\r\n            newState = {\r\n                ...state,\r\n                playerDamaged: true,\r\n                player: {\r\n                    ...state.player,\r\n                    currentHealth: Math.max(0, state.player.currentHealth - action.payload.damage)\r\n                },\r\n                battleLogs: [\r\n                    {\r\n                        id: Date.now(),\r\n                        text: action.payload.isCritical\r\n                            ? `æš´å‡»ï¼${state.monster.name}å¯¹${state.player.name}é€ æˆäº†${action.payload.damage}ç‚¹ä¼¤å®³ï¼`\r\n                            : `${state.monster.name}å¯¹${state.player.name}é€ æˆäº†${action.payload.damage}ç‚¹ä¼¤å®³ã€‚`,\r\n                        isCritical: action.payload.isCritical\r\n                    },\r\n                    ...state.battleLogs.slice(0, 19)\r\n                ]\r\n            };\r\n            break;\r\n\r\n        // ç©å®¶å—ä¼¤ç»“æŸ\r\n        case 'PLAYER_DAMAGE_END':\r\n            newState = {\r\n                ...state,\r\n                playerDamaged: false\r\n            };\r\n            break;\r\n\r\n        // æ·»åŠ æ—¥å¿—\r\n        case 'ADD_LOG':\r\n            newState = {\r\n                ...state,\r\n                battleLogs: [\r\n                    { id: Date.now(), text: action.payload.text, isCritical: action.payload.isCritical },\r\n                    ...state.battleLogs.slice(0, 19)\r\n                ]\r\n            };\r\n            break;\r\n\r\n        // ç©å®¶è·å¾—ç»éªŒ\r\n        case 'PLAYER_GAIN_EXPERIENCE':\r\n            {\r\n                const expGained = action.payload.experience;\r\n                let updatedPlayer = { ...state.player };\r\n                updatedPlayer.experience += expGained;\r\n\r\n                // æ£€æŸ¥æ˜¯å¦å‡çº§\r\n                let leveledUp = false;\r\n                while (updatedPlayer.experience >= updatedPlayer.expToNextLevel) {\r\n                    // å‡çº§\r\n                    updatedPlayer.level += 1;\r\n                    updatedPlayer.experience -= updatedPlayer.expToNextLevel;\r\n                    updatedPlayer.expToNextLevel = calculateExpToNextLevel(updatedPlayer.level);\r\n\r\n                    // å±æ€§æå‡\r\n                    const healthIncrease = Math.floor(20 + updatedPlayer.level * 5);\r\n                    updatedPlayer.maxHealth += healthIncrease;\r\n                    updatedPlayer.currentHealth += healthIncrease;\r\n                    updatedPlayer.attack += 2;\r\n                    updatedPlayer.defense += 1;\r\n                    updatedPlayer.agility += 1;\r\n\r\n                    // æ¯10çº§å¢åŠ æš´å‡»ç‡\r\n                    if (updatedPlayer.level % 10 === 0) {\r\n                        updatedPlayer.critChance += 0.05;\r\n                    }\r\n\r\n                    leveledUp = true;\r\n                }\r\n\r\n                const newLogs = leveledUp\r\n                    ? [\r\n                        {\r\n                            id: Date.now(),\r\n                            text: `è·å¾—${expGained}ç‚¹ç»éªŒï¼å‡çº§åˆ°${updatedPlayer.level}çº§ï¼`,\r\n                            isCritical: true\r\n                        },\r\n                        ...state.battleLogs\r\n                    ]\r\n                    : [\r\n                        {\r\n                            id: Date.now(),\r\n                            text: `è·å¾—${expGained}ç‚¹ç»éªŒï¼`,\r\n                            isCritical: false\r\n                        },\r\n                        ...state.battleLogs\r\n                    ];\r\n\r\n                newState = {\r\n                    ...state,\r\n                    player: updatedPlayer,\r\n                    battleLogs: newLogs.slice(0, 20)\r\n                };\r\n            }\r\n            break;\r\n\r\n        // æ‰è½è£…å¤‡\r\n        case 'DROP_EQUIPMENT':\r\n            {\r\n                // æ£€æŸ¥æ˜¯å¦æ‰è½è£…å¤‡\r\n                const monster = state.monster;\r\n                const randomRoll = Math.random();\r\n\r\n                if (randomRoll <= monster.dropChance) {\r\n                    // ç”Ÿæˆè£…å¤‡\r\n                    const equipment = generateEquipment(monster.level);\r\n\r\n                    // æ£€æŸ¥ç‰©å“æ æ˜¯å¦å·²æ»¡\r\n                    if (state.inventory.items.length >= state.inventory.maxSlots) {\r\n                        // ç‰©å“æ å·²æ»¡ï¼Œæ— æ³•è·å¾—è£…å¤‡\r\n                        newState = {\r\n                            ...state,\r\n                            battleLogs: [\r\n                                {\r\n                                    id: Date.now(),\r\n                                    text: `æ€ªç‰©æ‰è½äº†${equipment.rarityName}å“è´¨çš„${equipment.name}ï¼Œä½†ç‰©å“æ å·²æ»¡ï¼Œæ— æ³•æ‹¾å–ï¼`,\r\n                                    isCritical: true\r\n                                },\r\n                                ...state.battleLogs.slice(0, 19)\r\n                            ]\r\n                        };\r\n                        break;\r\n                    }\r\n\r\n                    // æ·»åŠ è£…å¤‡åˆ°ç‰©å“æ \r\n                    const newInventory = { ...state.inventory };\r\n                    newInventory.items.push({ ...equipment, count: 1 });\r\n\r\n                    newState = {\r\n                        ...state,\r\n                        inventory: newInventory,\r\n                        battleLogs: [\r\n                            {\r\n                                id: Date.now(),\r\n                                text: `æ€ªç‰©æ‰è½äº†${equipment.rarityName}å“è´¨çš„${equipment.name}ï¼`,\r\n                                isCritical: true\r\n                            },\r\n                            ...state.battleLogs.slice(0, 19)\r\n                        ]\r\n                    };\r\n                } else {\r\n                    // æ²¡æœ‰æ‰è½è£…å¤‡\r\n                    newState = state;\r\n                }\r\n            }\r\n            break;\r\n\r\n        // é‡ç½®æ€ªç‰©\r\n        case 'RESET_MONSTER':\r\n            newState = {\r\n                ...state,\r\n                monster: generateMonster(state.player.level, state.selectedBattlefield.id),\r\n                battleLogs: [\r\n                    { id: Date.now(), text: \"æ–°çš„æ€ªç‰©å‡ºç°äº†ï¼\", isCritical: false },\r\n                    ...state.battleLogs.slice(0, 19)\r\n                ]\r\n            };\r\n            break;\r\n\r\n        // æ¢å¤ç©å®¶ç”Ÿå‘½å€¼\r\n        case 'RESET_PLAYER_HEALTH':\r\n            newState = {\r\n                ...state,\r\n                player: {\r\n                    ...state.player,\r\n                    currentHealth: state.player.maxHealth\r\n                },\r\n                battleLogs: [\r\n                    { id: Date.now(), text: `${state.player.name}æ¢å¤äº†å¥åº·ï¼`, isCritical: false },\r\n                    ...state.battleLogs.slice(0, 19)\r\n                ]\r\n            };\r\n            break;\r\n\r\n        // åˆ‡æ¢æ¸¸æˆè¿è¡ŒçŠ¶æ€\r\n        case 'TOGGLE_GAME':\r\n            newState = {\r\n                ...state,\r\n                gameRunning: !state.gameRunning\r\n            };\r\n            break;\r\n\r\n        default:\r\n            return state;\r\n    }\r\n\r\n    // ä¿å­˜çŠ¶æ€åˆ°localStorage\r\n    localStorage.setItem('rpgGameState', JSON.stringify(newState));\r\n    return newState;\r\n}\r\n\r\n// åˆ›å»ºContext\r\nconst GameContext = createContext();\r\n\r\n// è‡ªå®šä¹‰é’©å­ï¼Œæ–¹ä¾¿ç»„ä»¶ä½¿ç”¨Context\r\nexport function useGame() {\r\n    return useContext(GameContext);\r\n}\r\n\r\n// Providerç»„ä»¶\r\nexport function GameProvider({ children }) {\r\n    const [state, dispatch] = useReducer(gameReducer, null, createInitialState);\r\n\r\n    // æˆ˜æ–—ä¼¤å®³è®¡ç®—\r\n    const calculateDamage = (attacker, defender) => {\r\n        // åŸºç¡€ä¼¤å®³ = æ”»å‡»åŠ› - é˜²å¾¡åŠ›/2\r\n        let baseDamage = Math.max(1, attacker.attack - defender.defense / 2);\r\n\r\n        // æ•æ·å½±å“å‘½ä¸­å’Œé—ªé¿\r\n        const agilityDiff = attacker.agility - defender.agility;\r\n\r\n        // å‘½ä¸­ç‡è°ƒæ•´ (åŠ æˆæˆ–å‡å°‘æœ€å¤š20%)\r\n        const hitRateAdjustment = Math.min(0.2, Math.max(-0.2, agilityDiff * 0.02));\r\n        const baseHitRate = 0.9; // åŸºç¡€90%å‘½ä¸­ç‡\r\n        const hitRate = Math.min(0.99, Math.max(0.7, baseHitRate + hitRateAdjustment));\r\n\r\n        // æ£€æŸ¥æ˜¯å¦å‘½ä¸­\r\n        if (Math.random() > hitRate) {\r\n            // é—ªé¿\r\n            return 0;\r\n        }\r\n\r\n        // éšæœºæ³¢åŠ¨ (Â±20%)\r\n        const randomFactor = 0.8 + Math.random() * 0.4;\r\n        return Math.floor(baseDamage * randomFactor);\r\n    };\r\n\r\n    // æ¸¸æˆä¸»å¾ªç¯\r\n    useEffect(() => {\r\n        // åªåœ¨æˆ˜æ–—åœºæ™¯ä¸”æ¸¸æˆæ­£åœ¨è¿è¡Œæ—¶æ‰§è¡Œæˆ˜æ–—å¾ªç¯\r\n        if (state.gameScene !== 'battle' || !state.gameRunning || !state.monster) return;\r\n\r\n        const gameLoop = setInterval(() => {\r\n            // æ£€æŸ¥ç©å®¶æ˜¯å¦æ­»äº¡\r\n            if (state.player.currentHealth <= 0) {\r\n                dispatch({\r\n                    type: 'ADD_LOG',\r\n                    payload: {\r\n                        text: `æˆ˜æ–—å¤±è´¥ï¼${state.player.name}è¢«${state.monster.name}å‡»è´¥äº†ï¼`,\r\n                        isCritical: true\r\n                    }\r\n                });\r\n\r\n                // å»¶è¿Ÿåè¿”å›é€‰æ‹©é¡µé¢\r\n                setTimeout(() => {\r\n                    dispatch({ type: 'RETURN_TO_SELECT' });\r\n                }, 2000);\r\n\r\n                return;\r\n            }\r\n\r\n            // æ£€æŸ¥æ€ªç‰©æ˜¯å¦æ­»äº¡\r\n            if (state.monster.currentHealth <= 0) {\r\n                dispatch({\r\n                    type: 'ADD_LOG',\r\n                    payload: {\r\n                        text: `æˆ˜æ–—èƒœåˆ©ï¼${state.player.name}å‡»è´¥äº†${state.monster.name}ï¼`,\r\n                        isCritical: true\r\n                    }\r\n                });\r\n\r\n                // è·å¾—ç»éªŒå€¼\r\n                dispatch({\r\n                    type: 'PLAYER_GAIN_EXPERIENCE',\r\n                    payload: { experience: state.monster.expReward }\r\n                });\r\n\r\n                // æ£€æŸ¥æ˜¯å¦æ‰è½è£…å¤‡\r\n                dispatch({ type: 'DROP_EQUIPMENT' });\r\n\r\n                // æ¢å¤ç©å®¶è¡€é‡\r\n                setTimeout(() => {\r\n                    dispatch({ type: 'RESET_PLAYER_HEALTH' });\r\n                }, 1000);\r\n\r\n                // ç”Ÿæˆæ–°æ€ªç‰©\r\n                setTimeout(() => {\r\n                    dispatch({ type: 'RESET_MONSTER' });\r\n                }, 2000);\r\n\r\n                return;\r\n            }\r\n\r\n            // ç©å®¶æ”»å‡»\r\n            dispatch({ type: 'PLAYER_ATTACK' });\r\n\r\n            setTimeout(() => {\r\n                dispatch({ type: 'PLAYER_ATTACK_END' });\r\n\r\n                const isCritical = Math.random() < state.player.critChance;\r\n                let damage = calculateDamage(state.player, state.monster);\r\n\r\n                if (damage === 0) {\r\n                    dispatch({\r\n                        type: 'ADD_LOG',\r\n                        payload: {\r\n                            text: `${state.monster.name}é—ªé¿äº†${state.player.name}çš„æ”»å‡»ï¼`,\r\n                            isCritical: false\r\n                        }\r\n                    });\r\n                } else {\r\n                    if (isCritical) {\r\n                        damage = Math.floor(damage * state.player.critMultiplier);\r\n                    }\r\n\r\n                    dispatch({\r\n                        type: 'MONSTER_DAMAGE',\r\n                        payload: { damage, isCritical }\r\n                    });\r\n                }\r\n\r\n                setTimeout(() => {\r\n                    dispatch({ type: 'MONSTER_DAMAGE_END' });\r\n\r\n                    // æ€ªç‰©æ”»å‡» (å¦‚æœè¿˜æ´»ç€)\r\n                    if (state.monster.currentHealth > 0) {\r\n                        setTimeout(() => {\r\n                            dispatch({ type: 'MONSTER_ATTACK' });\r\n\r\n                            setTimeout(() => {\r\n                                dispatch({ type: 'MONSTER_ATTACK_END' });\r\n\r\n                                const monsterCritical = Math.random() < state.monster.critChance;\r\n                                let monsterDamage = calculateDamage(state.monster, state.player);\r\n\r\n                                if (monsterDamage === 0) {\r\n                                    dispatch({\r\n                                        type: 'ADD_LOG',\r\n                                        payload: {\r\n                                            text: `${state.player.name}é—ªé¿äº†${state.monster.name}çš„æ”»å‡»ï¼`,\r\n                                            isCritical: false\r\n                                        }\r\n                                    });\r\n                                } else {\r\n                                    if (monsterCritical) {\r\n                                        monsterDamage = Math.floor(monsterDamage * state.monster.critMultiplier);\r\n                                    }\r\n\r\n                                    dispatch({\r\n                                        type: 'PLAYER_DAMAGE',\r\n                                        payload: { damage: monsterDamage, isCritical: monsterCritical }\r\n                                    });\r\n                                }\r\n\r\n                                setTimeout(() => {\r\n                                    dispatch({ type: 'PLAYER_DAMAGE_END' });\r\n                                }, 500);\r\n                            }, 500);\r\n                        }, 500);\r\n                    }\r\n                }, 500);\r\n            }, 500);\r\n\r\n        }, state.gameSpeed);\r\n\r\n        return () => clearInterval(gameLoop);\r\n    }, [state.gameScene, state.gameRunning, state.player, state.monster, state.selectedBattlefield]);\r\n\r\n    const value = {\r\n        state,\r\n        dispatch,\r\n        calculateExpToNextLevel,\r\n        equipmentTypes,\r\n        rarities\r\n    };\r\n\r\n    return (\r\n        <GameContext.Provider value={value}>\r\n            {children}\r\n        </GameContext.Provider>\r\n    );\r\n}"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}