{"ast":null,"code":"import React,{useState}from'react';import'./Modal.css';import{useGame}from'../../contexts/GameContext';import ItemContextMenu from'./ItemContextMenu';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const InventoryModal=()=>{const{state,dispatch}=useGame();const{inventory}=state;// 右键菜单状态\nconst[contextMenu,setContextMenu]=useState({isOpen:false,position:{x:0,y:0},item:null});// 关闭模态窗口\nconst handleClose=()=>{dispatch({type:'CLOSE_MODAL'});};// 处理右键点击物品\nconst handleRightClick=(e,item)=>{e.preventDefault();setContextMenu({isOpen:true,position:{x:e.clientX,y:e.clientY},item});};// 关闭右键菜单\nconst closeContextMenu=()=>{setContextMenu({...contextMenu,isOpen:false});};// 装备物品\nconst handleEquip=item=>{dispatch({type:'EQUIP_ITEM',payload:item});closeContextMenu();};// 丢弃物品\nconst handleDiscard=item=>{if(window.confirm(`确定要丢弃 ${item.name} x${item.count} 吗？`)){dispatch({type:'DISCARD_ITEM',payload:item});}closeContextMenu();};// 属性名称映射\nconst attributeNames={HEALTH:'生命值',ATTACK:'攻击力',DEFENSE:'防御力',AGILITY:'敏捷度',CRIT_CHANCE:'暴击率'};// 渲染装备属性\nconst renderAttributes=attributes=>{if(!attributes||Object.keys(attributes).length===0){return/*#__PURE__*/_jsx(\"div\",{className:\"empty-attributes\",children:\"\\u65E0\\u5C5E\\u6027\"});}return/*#__PURE__*/_jsx(\"div\",{className:\"item-attributes\",children:Object.entries(attributes).map(_ref=>{let[key,value]=_ref;return/*#__PURE__*/_jsxs(\"div\",{className:\"item-attribute\",children:[/*#__PURE__*/_jsxs(\"span\",{className:\"attribute-name\",children:[attributeNames[key]||key,\":\"]}),/*#__PURE__*/_jsx(\"span\",{className:\"attribute-value\",children:key==='CRIT_CHANCE'?`+${(value*100).toFixed(1)}%`:`+${value}`})]},key);})});};return/*#__PURE__*/_jsx(\"div\",{className:\"modal-overlay\",onClick:handleClose,children:/*#__PURE__*/_jsxs(\"div\",{className:\"modal-content inventory-modal\",onClick:e=>e.stopPropagation(),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"modal-header\",children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\u7269\\u54C1\\u680F\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"inventory-capacity\",children:[inventory.items.length,\" / \",inventory.maxSlots]}),/*#__PURE__*/_jsx(\"button\",{className:\"close-button\",onClick:handleClose,children:\"\\xD7\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"inventory-container\",children:[/*#__PURE__*/_jsx(\"div\",{className:\"inventory-help\",children:\"\\u53F3\\u952E\\u70B9\\u51FB\\u7269\\u54C1\\u53EF\\u4EE5\\u8FDB\\u884C\\u88C5\\u5907\\u6216\\u4E22\\u5F03\\u64CD\\u4F5C\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"inventory-grid\",children:[inventory.items.length>0?inventory.items.map(item=>/*#__PURE__*/_jsxs(\"div\",{className:\"inventory-item\",style:{borderColor:item.rarityColor||'#a0a0a0'},onContextMenu:e=>handleRightClick(e,item),children:[/*#__PURE__*/_jsxs(\"div\",{className:\"item-header\",children:[/*#__PURE__*/_jsx(\"span\",{className:\"item-emoji\",children:item.emoji}),/*#__PURE__*/_jsx(\"span\",{className:\"item-name\",style:{color:item.rarityColor},children:item.name})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"item-details\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"item-level\",children:[\"\\u7B49\\u7EA7 \",item.level]}),item.rarityName&&/*#__PURE__*/_jsx(\"div\",{className:\"item-rarity\",style:{color:item.rarityColor},children:item.rarityName})]}),renderAttributes(item.attributes),item.count>1&&/*#__PURE__*/_jsxs(\"div\",{className:\"item-count\",children:[\"x\",item.count]})]},item.id)):/*#__PURE__*/_jsx(\"div\",{className:\"empty-inventory\",children:\"\\u7269\\u54C1\\u680F\\u4E3A\\u7A7A\"}),Array.from({length:inventory.maxSlots-inventory.items.length}).map((_,index)=>/*#__PURE__*/_jsx(\"div\",{className:\"inventory-slot-empty\"},`empty-${index}`))]})]}),contextMenu.isOpen&&/*#__PURE__*/_jsx(ItemContextMenu,{position:contextMenu.position,item:contextMenu.item,onClose:closeContextMenu,onEquip:handleEquip,onDiscard:handleDiscard})]})});};export default InventoryModal;","map":{"version":3,"names":["React","useState","useGame","ItemContextMenu","jsx","_jsx","jsxs","_jsxs","InventoryModal","state","dispatch","inventory","contextMenu","setContextMenu","isOpen","position","x","y","item","handleClose","type","handleRightClick","e","preventDefault","clientX","clientY","closeContextMenu","handleEquip","payload","handleDiscard","window","confirm","name","count","attributeNames","HEALTH","ATTACK","DEFENSE","AGILITY","CRIT_CHANCE","renderAttributes","attributes","Object","keys","length","className","children","entries","map","_ref","key","value","toFixed","onClick","stopPropagation","items","maxSlots","style","borderColor","rarityColor","onContextMenu","emoji","color","level","rarityName","id","Array","from","_","index","onClose","onEquip","onDiscard"],"sources":["D:/mm-rpg-react/src/components/Modals/InventoryModal.jsx"],"sourcesContent":["import React, { useState } from 'react';\r\nimport './Modal.css';\r\nimport { useGame } from '../../contexts/GameContext';\r\nimport ItemContextMenu from './ItemContextMenu';\r\n\r\nconst InventoryModal = () => {\r\n    const { state, dispatch } = useGame();\r\n    const { inventory } = state;\r\n\r\n    // 右键菜单状态\r\n    const [contextMenu, setContextMenu] = useState({\r\n        isOpen: false,\r\n        position: { x: 0, y: 0 },\r\n        item: null\r\n    });\r\n\r\n    // 关闭模态窗口\r\n    const handleClose = () => {\r\n        dispatch({ type: 'CLOSE_MODAL' });\r\n    };\r\n\r\n    // 处理右键点击物品\r\n    const handleRightClick = (e, item) => {\r\n        e.preventDefault();\r\n        setContextMenu({\r\n            isOpen: true,\r\n            position: { x: e.clientX, y: e.clientY },\r\n            item\r\n        });\r\n    };\r\n\r\n    // 关闭右键菜单\r\n    const closeContextMenu = () => {\r\n        setContextMenu({\r\n            ...contextMenu,\r\n            isOpen: false\r\n        });\r\n    };\r\n\r\n    // 装备物品\r\n    const handleEquip = (item) => {\r\n        dispatch({ type: 'EQUIP_ITEM', payload: item });\r\n        closeContextMenu();\r\n    };\r\n\r\n    // 丢弃物品\r\n    const handleDiscard = (item) => {\r\n        if (window.confirm(`确定要丢弃 ${item.name} x${item.count} 吗？`)) {\r\n            dispatch({ type: 'DISCARD_ITEM', payload: item });\r\n        }\r\n        closeContextMenu();\r\n    };\r\n\r\n    // 属性名称映射\r\n    const attributeNames = {\r\n        HEALTH: '生命值',\r\n        ATTACK: '攻击力',\r\n        DEFENSE: '防御力',\r\n        AGILITY: '敏捷度',\r\n        CRIT_CHANCE: '暴击率'\r\n    };\r\n\r\n    // 渲染装备属性\r\n    const renderAttributes = (attributes) => {\r\n        if (!attributes || Object.keys(attributes).length === 0) {\r\n            return <div className=\"empty-attributes\">无属性</div>;\r\n        }\r\n\r\n        return (\r\n            <div className=\"item-attributes\">\r\n                {Object.entries(attributes).map(([key, value]) => (\r\n                    <div key={key} className=\"item-attribute\">\r\n                        <span className=\"attribute-name\">{attributeNames[key] || key}:</span>\r\n                        <span className=\"attribute-value\">\r\n                            {key === 'CRIT_CHANCE'\r\n                                ? `+${(value * 100).toFixed(1)}%`\r\n                                : `+${value}`}\r\n                        </span>\r\n                    </div>\r\n                ))}\r\n            </div>\r\n        );\r\n    };\r\n\r\n    return (\r\n        <div className=\"modal-overlay\" onClick={handleClose}>\r\n            <div className=\"modal-content inventory-modal\" onClick={(e) => e.stopPropagation()}>\r\n                <div className=\"modal-header\">\r\n                    <h2>物品栏</h2>\r\n                    <div className=\"inventory-capacity\">\r\n                        {inventory.items.length} / {inventory.maxSlots}\r\n                    </div>\r\n                    <button className=\"close-button\" onClick={handleClose}>×</button>\r\n                </div>\r\n\r\n                <div className=\"inventory-container\">\r\n                    <div className=\"inventory-help\">\r\n                        右键点击物品可以进行装备或丢弃操作\r\n                    </div>\r\n\r\n                    <div className=\"inventory-grid\">\r\n                        {inventory.items.length > 0 ? (\r\n                            inventory.items.map((item) => (\r\n                                <div\r\n                                    key={item.id}\r\n                                    className=\"inventory-item\"\r\n                                    style={{ borderColor: item.rarityColor || '#a0a0a0' }}\r\n                                    onContextMenu={(e) => handleRightClick(e, item)}\r\n                                >\r\n                                    <div className=\"item-header\">\r\n                                        <span className=\"item-emoji\">{item.emoji}</span>\r\n                                        <span\r\n                                            className=\"item-name\"\r\n                                            style={{ color: item.rarityColor }}\r\n                                        >\r\n                                            {item.name}\r\n                                        </span>\r\n                                    </div>\r\n\r\n                                    <div className=\"item-details\">\r\n                                        <div className=\"item-level\">等级 {item.level}</div>\r\n                                        {item.rarityName && (\r\n                                            <div\r\n                                                className=\"item-rarity\"\r\n                                                style={{ color: item.rarityColor }}\r\n                                            >\r\n                                                {item.rarityName}\r\n                                            </div>\r\n                                        )}\r\n                                    </div>\r\n\r\n                                    {renderAttributes(item.attributes)}\r\n\r\n                                    {item.count > 1 && (\r\n                                        <div className=\"item-count\">x{item.count}</div>\r\n                                    )}\r\n                                </div>\r\n                            ))\r\n                        ) : (\r\n                            <div className=\"empty-inventory\">\r\n                                物品栏为空\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* 显示空格子 */}\r\n                        {Array.from({ length: inventory.maxSlots - inventory.items.length }).map((_, index) => (\r\n                            <div key={`empty-${index}`} className=\"inventory-slot-empty\"></div>\r\n                        ))}\r\n                    </div>\r\n                </div>\r\n\r\n                {/* 右键菜单 */}\r\n                {contextMenu.isOpen && (\r\n                    <ItemContextMenu\r\n                        position={contextMenu.position}\r\n                        item={contextMenu.item}\r\n                        onClose={closeContextMenu}\r\n                        onEquip={handleEquip}\r\n                        onDiscard={handleDiscard}\r\n                    />\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n};\r\n\r\nexport default InventoryModal;"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}